<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pymatgen.io.abinitio.abiobjects &mdash; pymatgen 2.9.10 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/proBlue.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '2.9.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="pymatgen 2.9.10 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33990148-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">pymatgen 2.9.10 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pymatgen.io.abinitio.abiobjects</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Low-level objects providing an abstraction for the objects involved in the</span>
<span class="sd">calculation.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pymatgen.core.units</span> <span class="kn">as</span> <span class="nn">units</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>
<span class="kn">from</span> <span class="nn">monty.design_patterns</span> <span class="kn">import</span> <span class="n">singleton</span>
<span class="kn">from</span> <span class="nn">pymatgen.util.string_utils</span> <span class="kn">import</span> <span class="n">is_string</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.design_patterns</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">AttrDict</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.units</span> <span class="kn">import</span> <span class="n">ArrayWithUnit</span>
<span class="kn">from</span> <span class="nn">pymatgen.serializers.json_coders</span> <span class="kn">import</span> <span class="n">MSONable</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.finder</span> <span class="kn">import</span> <span class="n">SymmetryFinder</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.smartio</span> <span class="kn">import</span> <span class="n">read_structure</span>

<span class="kn">from</span> <span class="nn">.netcdf</span> <span class="kn">import</span> <span class="n">structure_from_etsf_file</span>


<div class="viewcode-block" id="AbivarAble"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbivarAble">[docs]</a><span class="k">class</span> <span class="nc">AbivarAble</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An AbivarAble object provides a method to_abivars that returns a dictionary</span>
<span class="sd">    with the abinit variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="AbivarAble.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbivarAble.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary with the abinit variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_abivars</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

</div>
<span class="nd">@singleton</span>
<span class="k">class</span> <span class="nc">MandatoryVariable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Singleton used to tag mandatory variables, just because I can use</span>
<span class="sd">    the cool syntax: variable is MANDATORY!</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="nd">@singleton</span>
<span class="k">class</span> <span class="nc">DefaultVariable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Singleton used to tag variables that will have the default value</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="n">MANDATORY</span> <span class="o">=</span> <span class="n">MandatoryVariable</span><span class="p">()</span>
<span class="n">DEFAULT</span> <span class="o">=</span> <span class="n">DefaultVariable</span><span class="p">()</span>


<div class="viewcode-block" id="SpinMode"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SpinMode">[docs]</a><span class="k">class</span> <span class="nc">SpinMode</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;SpinMode&#39;</span><span class="p">,</span> <span class="s">&quot;mode nsppol nspinor nspden&quot;</span><span class="p">),</span>
               <span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Different configurations of the electron density as implemented in abinit:</span>
<span class="sd">    One can use asspinmode to construct the object via SpinMode.asspinmode</span>
<span class="sd">    (string) where string can assume the values:</span>

<span class="sd">        - polarized</span>
<span class="sd">        - unpolarized</span>
<span class="sd">        - afm (anti-ferromagnetic)</span>
<span class="sd">        - spinor (non-collinear magnetism)</span>
<span class="sd">        - spinor_nomag (non-collinear, no magnetism)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SpinMode.asspinmode"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SpinMode.asspinmode">[docs]</a>    <span class="k">def</span> <span class="nf">asspinmode</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts obj into a SpinMode instance&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Assume a string with mode</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_mode2spinvars</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Wrong value for spin_mode: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SpinMode.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SpinMode.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&quot;nsppol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsppol</span><span class="p">,</span>
            <span class="s">&quot;nspinor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspinor</span><span class="p">,</span>
            <span class="s">&quot;nspden&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspden</span><span class="p">,</span>
        <span class="p">}</span>

<span class="c"># An handy Multiton</span></div></div>
<span class="n">_mode2spinvars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;unpolarized&quot;</span> <span class="p">:</span> <span class="n">SpinMode</span><span class="p">(</span><span class="s">&quot;unpolarized&quot;</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s">&quot;polarized&quot;</span>   <span class="p">:</span> <span class="n">SpinMode</span><span class="p">(</span><span class="s">&quot;polarized&quot;</span>   <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s">&quot;afm&quot;</span>         <span class="p">:</span> <span class="n">SpinMode</span><span class="p">(</span><span class="s">&quot;afm&quot;</span>         <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s">&quot;spinor&quot;</span>      <span class="p">:</span> <span class="n">SpinMode</span><span class="p">(</span><span class="s">&quot;spinor&quot;</span>      <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="s">&quot;spinor_nomag&quot;</span><span class="p">:</span> <span class="n">SpinMode</span><span class="p">(</span><span class="s">&quot;spinor_nomag&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">}</span>


<div class="viewcode-block" id="Smearing"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing">[docs]</a><span class="k">class</span> <span class="nc">Smearing</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">,</span> <span class="n">MSONable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variables defining the smearing technique. The preferred way to instanciate</span>
<span class="sd">    a Smearing object is via the class method Smearing.assmearing(string)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#: Mapping string_mode --&gt; occopt</span>
    <span class="n">_mode2occopt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;nosmearing&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&#39;fermi_dirac&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s">&#39;marzari4&#39;</span>   <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s">&#39;marzari5&#39;</span>   <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s">&#39;methfessel&#39;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s">&#39;gaussian&#39;</span>   <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">occopt</span><span class="p">,</span> <span class="n">tsmear</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occopt</span> <span class="o">=</span> <span class="n">occopt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsmear</span> <span class="o">=</span> <span class="n">tsmear</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;occopt </span><span class="si">%d</span><span class="s"> # </span><span class="si">%s</span><span class="s"> Smearing</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occopt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsmear</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;tsmear </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsmear</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occopt</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">occopt</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsmear</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">tsmear</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s">&quot;nosmearing&quot;</span>

    <span class="c"># py2 old version</span>
    <span class="n">__nonzero__</span> <span class="o">=</span> <span class="n">__bool__</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Smearing.assmearing"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing.assmearing">[docs]</a>    <span class="k">def</span> <span class="nf">assmearing</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs an instance of Smearing from obj. Accepts obj in the form:</span>

<span class="sd">            * Smearing instance</span>
<span class="sd">            * &quot;name:tsmear&quot;  e.g. &quot;gaussian:0.004&quot;  (Hartree units)</span>
<span class="sd">            * &quot;name:tsmear units&quot; e.g. &quot;gaussian:0.1 eV&quot;</span>
<span class="sd">            * None --&gt; no smearing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Smearing</span><span class="o">.</span><span class="n">nosmearing</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="c"># obj is a string</span>
        <span class="n">obj</span><span class="p">,</span> <span class="n">tsmear</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="s">&quot;nosmearing&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">nosmearing</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">occopt</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_mode2occopt</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tsmear</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tsmear</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">tsmear</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">tsmear</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">tsmear</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">Energy</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tsmear</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s">&quot;Ha&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">occopt</span><span class="p">,</span> <span class="n">tsmear</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Smearing.mode"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing.mode">[docs]</a>    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">mode_str</span><span class="p">,</span> <span class="n">occopt</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode2occopt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">occopt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">occopt</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mode_str</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Unknown occopt </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">occopt</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Smearing.nosmearing"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing.nosmearing">[docs]</a>    <span class="k">def</span> <span class="nf">nosmearing</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">Smearing</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Smearing.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;nosmearing&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&quot;occopt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">occopt</span><span class="p">,</span>
                    <span class="s">&quot;tsmear&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsmear</span><span class="p">,}</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Smearing.to_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;json friendly dict representation of Smearing&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;occopt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">occopt</span><span class="p">,</span> <span class="s">&quot;tsmear&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsmear</span><span class="p">,</span>
                <span class="s">&quot;@module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
                <span class="s">&quot;@class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">}</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Smearing.from_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Smearing.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Smearing</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;occopt&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;tsmear&quot;</span><span class="p">])</span>


</div></div>
<div class="viewcode-block" id="ElectronsAlgorithm"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ElectronsAlgorithm">[docs]</a><span class="k">class</span> <span class="nc">ElectronsAlgorithm</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">AbivarAble</span><span class="p">):</span>
    <span class="s">&quot;Variables controlling the SCF/NSCF algorithm.&quot;</span>
    <span class="c"># None indicates that we use abinit defaults.</span>
    <span class="n">_default_vars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;iprcell&quot;</span>  <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;iscf&quot;</span>     <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;diemac&quot;</span>   <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;diemix&quot;</span>   <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;diemixmag&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;dielam&quot;</span>   <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;diegap&quot;</span>   <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;dielng&quot;</span>   <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;diecut&quot;</span>   <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;nstep&quot;</span>    <span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ElectronsAlgorithm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_vars</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: No default value has been provided for &quot;</span>
                                 <span class="s">&quot;key </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

<div class="viewcode-block" id="ElectronsAlgorithm.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ElectronsAlgorithm.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="Electrons"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Electrons">[docs]</a><span class="k">class</span> <span class="nc">Electrons</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The electronic degrees of freedom</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">spin_mode</span> <span class="o">=</span> <span class="s">&quot;polarized&quot;</span><span class="p">,</span>
                 <span class="n">smearing</span>  <span class="o">=</span> <span class="s">&quot;fermi_dirac:0.1 eV&quot;</span><span class="p">,</span>
                 <span class="n">algorithm</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">nband</span>     <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">fband</span>     <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">charge</span>    <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">comment</span>   <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="c">#occupancies = None,</span>
                <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for Electrons object.</span>

<span class="sd">        Args:</span>
<span class="sd">            comment:</span>
<span class="sd">                String comment for Electrons</span>

<span class="sd">            charge: float</span>
<span class="sd">                    Total charge of the system. Default is 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Electrons</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smearing</span> <span class="o">=</span> <span class="n">Smearing</span><span class="o">.</span><span class="n">assmearing</span><span class="p">(</span><span class="n">smearing</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spin_mode</span> <span class="o">=</span> <span class="n">SpinMode</span><span class="o">.</span><span class="n">asspinmode</span><span class="p">(</span><span class="n">spin_mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nband</span> <span class="o">=</span> <span class="n">nband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fband</span> <span class="o">=</span> <span class="n">fband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>

        <span class="c"># FIXME</span>
        <span class="k">if</span> <span class="n">nband</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fband</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Electrons.nsppol"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Electrons.nsppol">[docs]</a>    <span class="k">def</span> <span class="nf">nsppol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_mode</span><span class="o">.</span><span class="n">nsppol</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Electrons.nspinor"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Electrons.nspinor">[docs]</a>    <span class="k">def</span> <span class="nf">nspinor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_mode</span><span class="o">.</span><span class="n">nspinor</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Electrons.nspden"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Electrons.nspden">[docs]</a>    <span class="k">def</span> <span class="nf">nspden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_mode</span><span class="o">.</span><span class="n">nspden</span>

    <span class="c">#@property</span>
    <span class="c">#def to_dict(self):</span>
    <span class="c">#    &quot;json friendly dict representation&quot;</span>
    <span class="c">#    d = {}</span>
    <span class="c">#    d[&quot;@module&quot;] = self.__class__.__module__</span>
    <span class="c">#    d[&quot;@class&quot;] = self.__class__.__name__</span>
    <span class="c">#    raise NotImplementedError(&quot;&quot;)</span>
    <span class="c">#    return d</span>

    <span class="c">#@staticmethod</span>
    <span class="c">#def from_dict(d):</span>
    <span class="c">#    raise NotImplementedError(&quot;&quot;)</span>
</div>
<div class="viewcode-block" id="Electrons.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Electrons.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">abivars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_mode</span><span class="o">.</span><span class="n">to_abivars</span><span class="p">()</span>

        <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s">&quot;nband&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">,</span>
            <span class="s">&quot;fband&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fband</span><span class="p">,</span>
            <span class="s">&quot;charge&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing</span><span class="p">:</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smearing</span><span class="o">.</span><span class="n">to_abivars</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">:</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>

        <span class="n">abivars</span><span class="p">[</span><span class="s">&quot;#comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span>
        <span class="k">return</span> <span class="n">abivars</span>

</div></div>
<div class="viewcode-block" id="asabistructure"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.asabistructure">[docs]</a><span class="k">def</span> <span class="nf">asabistructure</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert obj into an AbiStructure object. Accepts:</span>

<span class="sd">        - AbiStructure instance</span>
<span class="sd">        - Subinstances of pymatgen.</span>
<span class="sd">        - File paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">AbiStructure</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="c"># Promote</span>
        <span class="k">return</span> <span class="n">AbiStructure</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="c"># Handle file paths.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.nc&quot;</span><span class="p">):</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">structure_from_etsf_file</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="c">#print(structure._sites)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">read_structure</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="c"># Promote</span>
            <span class="k">return</span> <span class="n">AbiStructure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Don&#39;t know how to convert object </span><span class="si">%s</span><span class="s"> to an AbiStructure structure&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="AbiStructure"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbiStructure">[docs]</a><span class="k">class</span> <span class="nc">AbiStructure</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Patches the pymatgen structure adding the method to_abivars.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="AbiStructure.asabistructure"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbiStructure.asabistructure">[docs]</a>    <span class="k">def</span> <span class="nf">asabistructure</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">asabistructure</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="n">new</span><span class="o">.</span><span class="n">__class__</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AbiStructure.boxed_molecule"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbiStructure.boxed_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">boxed_molecule</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pseudos</span><span class="p">,</span> <span class="n">cart_coords</span><span class="p">,</span> <span class="n">acell</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="p">,)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a molecule in a periodic box of lengths acell [Bohr]</span>

<span class="sd">        Args:</span>
<span class="sd">            pseudos:</span>
<span class="sd">                List of pseudopotentials</span>
<span class="sd">            cart_coords:</span>
<span class="sd">                Cartesian coordinates</span>
<span class="sd">            acell:</span>
<span class="sd">                Lengths of the box in *Bohr*</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cart_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">cart_coords</span><span class="p">)</span>

        <span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pseudos</span><span class="p">],</span> <span class="n">cart_coords</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">ArrayWithUnit</span><span class="p">(</span><span class="n">acell</span><span class="p">,</span> <span class="s">&quot;bohr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s">&quot;ang&quot;</span><span class="p">)</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">get_boxed_structure</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AbiStructure.boxed_atom"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbiStructure.boxed_atom">[docs]</a>    <span class="k">def</span> <span class="nf">boxed_atom</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pseudo</span><span class="p">,</span> <span class="n">cart_coords</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">acell</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="p">,)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an atom in a periodic box of lengths acell [Bohr]</span>

<span class="sd">        Args:</span>
<span class="sd">            pseudo:</span>
<span class="sd">                Pseudopotential object.</span>
<span class="sd">            cart_coords:</span>
<span class="sd">                Cartesian coordinates</span>
<span class="sd">            acell:</span>
<span class="sd">                Lengths of the box in *Bohr*</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">boxed_molecule</span><span class="p">([</span><span class="n">pseudo</span><span class="p">],</span> <span class="n">cart_coords</span><span class="p">,</span> <span class="n">acell</span><span class="o">=</span><span class="n">acell</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AbiStructure.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.AbiStructure.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns a dictionary with the abinit variables.&quot;</span>
        <span class="n">types_of_specie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types_of_specie</span>
        <span class="n">natom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sites</span>

        <span class="n">znucl_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="n">types_of_specie</span><span class="p">]</span>

        <span class="n">znucl_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_numbers</span>

        <span class="n">typat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">natom</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">atm_idx</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">typat</span><span class="p">[</span><span class="n">atm_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">types_of_specie</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">rprim</span> <span class="o">=</span> <span class="n">ArrayWithUnit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="s">&quot;ang&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s">&quot;bohr&quot;</span><span class="p">)</span>
        <span class="n">xred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">frac_coords</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&quot;acell&quot;</span> <span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="s">&quot;rprim&quot;</span> <span class="p">:</span> <span class="n">rprim</span><span class="p">,</span>
            <span class="s">&quot;natom&quot;</span> <span class="p">:</span> <span class="n">natom</span><span class="p">,</span>
            <span class="s">&quot;ntypat&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">types_of_specie</span><span class="p">),</span>
            <span class="s">&quot;typat&quot;</span> <span class="p">:</span> <span class="n">typat</span><span class="p">,</span>
            <span class="s">&quot;xred&quot;</span>  <span class="p">:</span> <span class="n">xred</span><span class="p">,</span>
            <span class="s">&quot;znucl&quot;</span> <span class="p">:</span> <span class="n">znucl_type</span><span class="p">,</span>
        <span class="p">}</span>

</div></div>
<div class="viewcode-block" id="KSampling"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling">[docs]</a><span class="k">class</span> <span class="nc">KSampling</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input variables defining the K-point sampling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Modes supported by the constructor.</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">((</span><span class="s">&#39;monkhorst&#39;</span><span class="p">,</span> <span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="s">&#39;automatic&#39;</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">mode</span>              <span class="o">=</span> <span class="s">&quot;monkhorst&quot;</span><span class="p">,</span>
                 <span class="n">num_kpts</span>          <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">kpts</span>              <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),),</span>
                 <span class="n">kpt_shifts</span>        <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                 <span class="n">use_symmetries</span>    <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                 <span class="n">use_time_reversal</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                 <span class="n">kpts_weights</span>      <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">labels</span>            <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">chksymbreak</span>       <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">comment</span>           <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Highly flexible constructor for KSampling objects.  The flexibility comes</span>
<span class="sd">        at the cost of usability and in general, it is recommended that you use</span>
<span class="sd">        the default constructor only if you know exactly what you are doing and</span>
<span class="sd">        requires the flexibility.  For most usage cases, the object be constructed</span>
<span class="sd">        far more easily using the convenience static constructors:</span>

<span class="sd">            #. gamma_only</span>
<span class="sd">            #. gamma_centered</span>
<span class="sd">            #. monkhorst</span>
<span class="sd">            #. monkhorst_automatic</span>
<span class="sd">            #. path</span>

<span class="sd">        and it is recommended that you use those.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode:</span>
<span class="sd">                Mode for generating k-poits. Use one of the KSampling.modes</span>
<span class="sd">                enum types.</span>
<span class="sd">            num_kpts:</span>
<span class="sd">                Number of kpoints if mode is &quot;automatic&quot;</span>
<span class="sd">                Number of division for the sampling of the smallest segment if</span>
<span class="sd">                mode is &quot;path&quot;.</span>
<span class="sd">                Not used for the other modes</span>
<span class="sd">            kpts:</span>
<span class="sd">                Number of divisions. Even when only a single specification is</span>
<span class="sd">                required, e.g. in the automatic scheme, the kpts should still</span>
<span class="sd">                be specified as a 2D array. e.g., [[20]] or [[2,2,2]].</span>
<span class="sd">            kpt_shifts:</span>
<span class="sd">                Shifts for Kpoints.</span>
<span class="sd">            use_symmetries:</span>
<span class="sd">                False if spatial symmetries should not be used to reduced the</span>
<span class="sd">                number of independent k-points.</span>
<span class="sd">            use_time_reversal:</span>
<span class="sd">                False if time-reversal symmetry should not be used to reduced</span>
<span class="sd">                the number of independent k-points.</span>
<span class="sd">            kpts_weights:</span>
<span class="sd">                Optional weights for kpoints. For explicit kpoints.</span>
<span class="sd">            labels:</span>
<span class="sd">                In path-mode, this should provide a list of labels for each kpt.</span>
<span class="sd">            chksymbreak:</span>
<span class="sd">                Abinit input variable: check whether the BZ sampling preserves</span>
<span class="sd">                the symmetry of the crystal.</span>
<span class="sd">            comment:</span>
<span class="sd">                String comment for Kpoints</span>

<span class="sd">        The default behavior of the constructor is monkhorst.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">KSampling</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown kpoint mode </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">KSampling</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>

        <span class="n">abivars</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;monkhorst&quot;</span><span class="p">,):</span>
            <span class="k">assert</span> <span class="n">num_kpts</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">ngkpt</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
            <span class="n">shiftk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kpt_shifts</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">use_symmetries</span> <span class="ow">and</span> <span class="n">use_time_reversal</span><span class="p">:</span> <span class="n">kptopt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_symmetries</span> <span class="ow">and</span> <span class="n">use_time_reversal</span><span class="p">:</span> <span class="n">kptopt</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_symmetries</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_time_reversal</span><span class="p">:</span> <span class="n">kptopt</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">use_symmetries</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_time_reversal</span><span class="p">:</span> <span class="n">kptopt</span> <span class="o">=</span> <span class="mi">4</span>

            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s">&quot;ngkpt&quot;</span>      <span class="p">:</span> <span class="n">ngkpt</span><span class="p">,</span>
                <span class="s">&quot;shiftk&quot;</span>     <span class="p">:</span> <span class="n">shiftk</span><span class="p">,</span>
                <span class="s">&quot;nshiftk&quot;</span>    <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">shiftk</span><span class="p">),</span>
                <span class="s">&quot;kptopt&quot;</span>     <span class="p">:</span> <span class="n">kptopt</span><span class="p">,</span>
                <span class="s">&quot;chksymbreak&quot;</span><span class="p">:</span> <span class="n">chksymbreak</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">,):</span>

            <span class="k">if</span> <span class="n">num_kpts</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;For Path mode, num_kpts must be specified and &gt;0&quot;</span><span class="p">)</span>

            <span class="n">kptbounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,))</span>
            <span class="c">#print(&quot;in path with kptbound: %s &quot; % kptbounds)</span>

            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s">&quot;ndivsm&quot;</span>   <span class="p">:</span> <span class="n">num_kpts</span><span class="p">,</span>
                <span class="s">&quot;kptbounds&quot;</span><span class="p">:</span> <span class="n">kptbounds</span><span class="p">,</span>
                <span class="s">&quot;kptopt&quot;</span>   <span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">kptbounds</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                <span class="c">#&quot;labels&quot;  : labels,  # TODO</span>
            <span class="p">})</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;automatic&quot;</span><span class="p">,):</span>
            <span class="n">kpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_kpts</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;For Automatic mode, num_kpts must be specified.&quot;</span><span class="p">)</span>

            <span class="n">kptnrm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_kpts</span><span class="p">)</span>

            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s">&quot;kptopt&quot;</span>     <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&quot;kpt&quot;</span>        <span class="p">:</span> <span class="n">kpts</span><span class="p">,</span>
                <span class="s">&quot;nkpt&quot;</span>       <span class="p">:</span> <span class="n">num_kpts</span><span class="p">,</span>
                <span class="s">&quot;kptnrm&quot;</span>     <span class="p">:</span> <span class="n">kptnrm</span><span class="p">,</span>
                <span class="s">&quot;wtk&quot;</span>        <span class="p">:</span> <span class="n">kpts_weights</span><span class="p">,</span>  <span class="c"># for iscf/=-2, wtk.</span>
                <span class="s">&quot;chksymbreak&quot;</span><span class="p">:</span> <span class="n">chksymbreak</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown mode </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span> <span class="o">=</span> <span class="n">abivars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span><span class="p">[</span><span class="s">&quot;#comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="KSampling.is_homogeneous"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.is_homogeneous">[docs]</a>    <span class="k">def</span> <span class="nf">is_homogeneous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">,]</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.gamma_only"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.gamma_only">[docs]</a>    <span class="k">def</span> <span class="nf">gamma_only</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="s">&quot;Gamma-only sampling&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">kpt_shifts</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">comment</span><span class="o">=</span><span class="s">&quot;Gamma-only sampling&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.gamma_centered"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.gamma_centered">[docs]</a>    <span class="k">def</span> <span class="nf">gamma_centered</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">kpts</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">use_symmetries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_time_reversal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenient static constructor for an automatic Gamma centered Kpoint grid.</span>

<span class="sd">        Args:</span>
<span class="sd">            kpts:</span>
<span class="sd">                Subdivisions N_1, N_2 and N_3 along reciprocal lattice vectors.</span>
<span class="sd">        use_symmetries:</span>
<span class="sd">            False if spatial symmetries should not be used to reduced the number of independent k-points.</span>
<span class="sd">        use_time_reversal:</span>
<span class="sd">            False if time-reversal symmetry should not be used to reduced the number of independent k-points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `KSampling` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">kpts</span>              <span class="o">=</span> <span class="p">[</span><span class="n">kpts</span><span class="p">],</span>
                   <span class="n">use_symmetries</span>    <span class="o">=</span> <span class="n">use_symmetries</span><span class="p">,</span>
                   <span class="n">use_time_reversal</span> <span class="o">=</span> <span class="n">use_time_reversal</span><span class="p">,</span>
                   <span class="n">comment</span>           <span class="o">=</span> <span class="s">&quot;gamma-centered mode&quot;</span><span class="p">,</span>
                   <span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.monkhorst"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.monkhorst">[docs]</a>    <span class="k">def</span> <span class="nf">monkhorst</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ngkpt</span><span class="p">,</span> <span class="n">shiftk</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">chksymbreak</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_symmetries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                  <span class="n">use_time_reversal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenient static constructor for a Monkhorst-Pack mesh.</span>

<span class="sd">        Args:</span>
<span class="sd">            ngkpt:</span>
<span class="sd">                Subdivisions N_1, N_2 and N_3 along reciprocal lattice vectors.</span>
<span class="sd">            shiftk:</span>
<span class="sd">                Shift to be applied to the kpoints. Defaults to (0,0,0).</span>
<span class="sd">            use_symmetries:</span>
<span class="sd">                Use spatial symmetries to reduce the number of k-points.</span>
<span class="sd">            use_time_reversal:</span>
<span class="sd">                Use time-reversal symmetry to reduce the number of k-points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `KSampling` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">kpts</span>              <span class="o">=</span> <span class="p">[</span><span class="n">ngkpt</span><span class="p">],</span>
                   <span class="n">kpt_shifts</span>        <span class="o">=</span> <span class="n">shiftk</span><span class="p">,</span>
                   <span class="n">use_symmetries</span>    <span class="o">=</span> <span class="n">use_symmetries</span><span class="p">,</span>
                   <span class="n">use_time_reversal</span> <span class="o">=</span> <span class="n">use_time_reversal</span><span class="p">,</span>
                   <span class="n">chksymbreak</span>       <span class="o">=</span> <span class="n">chksymbreak</span><span class="p">,</span>
                   <span class="n">comment</span>           <span class="o">=</span> <span class="n">comment</span> <span class="k">if</span> <span class="n">comment</span> <span class="k">else</span> <span class="s">&quot;Monkhorst-Pack scheme with user-specified shiftk&quot;</span><span class="p">,</span>
                  <span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.monkhorst_automatic"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.monkhorst_automatic">[docs]</a>    <span class="k">def</span> <span class="nf">monkhorst_automatic</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">ngkpt</span><span class="p">,</span> <span class="n">chksymbreak</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_symmetries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_time_reversal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenient static constructor for an automatic Monkhorst-Pack mesh.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure:</span>
<span class="sd">                paymatgen structure object.</span>
<span class="sd">            ngkpt:</span>
<span class="sd">                Subdivisions N_1, N_2 and N_3 along reciprocal lattice vectors.</span>
<span class="sd">            use_symmetries:</span>
<span class="sd">                Use spatial symmetries to reduce the number of k-points.</span>
<span class="sd">            use_time_reversal:</span>
<span class="sd">                Use time-reversal symmetry to reduce the number of k-points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            KSampling object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sg</span> <span class="o">=</span> <span class="n">SymmetryFinder</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="c">#sg.get_crystal_system()</span>
        <span class="c">#sg.get_point_group()</span>
        <span class="c"># TODO</span>
        <span class="n">nshiftk</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c">#shiftk = 3*(0.5,) # this is the default</span>
        <span class="n">shiftk</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,)</span>

        <span class="c">#if lattice.ishexagonal:</span>
        <span class="c">#elif lattice.isbcc</span>
        <span class="c">#elif lattice.isfcc</span>

        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">monkhorst</span><span class="p">(</span><span class="n">ngkpt</span><span class="p">,</span>
                             <span class="n">shiftk</span>            <span class="o">=</span> <span class="n">shiftk</span><span class="p">,</span>
                             <span class="n">chksymbreak</span>       <span class="o">=</span> <span class="n">chksymbreak</span><span class="p">,</span>
                             <span class="n">use_symmetries</span>    <span class="o">=</span> <span class="n">use_symmetries</span><span class="p">,</span>
                             <span class="n">use_time_reversal</span> <span class="o">=</span> <span class="n">use_time_reversal</span><span class="p">,</span>
                             <span class="n">comment</span>           <span class="o">=</span> <span class="n">comment</span> <span class="k">if</span> <span class="n">comment</span> <span class="k">else</span> <span class="s">&quot;Automatic Monkhorst-Pack scheme&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_path</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ndivsm</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kpath_bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Static constructor for path in k-space.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure:</span>
<span class="sd">                pymatgen structure.</span>
<span class="sd">            kpath_bounds:</span>
<span class="sd">                List with the reduced coordinates of the k-points defining the path.</span>
<span class="sd">            ndivsm:</span>
<span class="sd">                Number of division for the smallest segment.</span>
<span class="sd">            comment:</span>
<span class="sd">                Comment string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            KSampling object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kpath_bounds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Compute the boundaries from the input structure.</span>
            <span class="kn">from</span> <span class="nn">pymatgen.symmetry.bandstructure</span> <span class="kn">import</span> <span class="n">HighSymmKpath</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">HighSymmKpath</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

            <span class="c"># Flat the array since &quot;path&quot; is a a list of lists!</span>
            <span class="n">kpath_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">kpath</span><span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">]:</span>
                <span class="n">kpath_labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

            <span class="n">kpath_bounds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">kpath_labels</span><span class="p">:</span>
                <span class="n">red_coord</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">kpath</span><span class="p">[</span><span class="s">&quot;kpoints&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">]</span>
                <span class="c">#print(&quot;label %s, red_coord %s&quot; % (label, red_coord))</span>
                <span class="n">kpath_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">red_coord</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">mode</span>     <span class="o">=</span> <span class="n">KSampling</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                   <span class="n">num_kpts</span> <span class="o">=</span> <span class="n">ndivsm</span><span class="p">,</span>
                   <span class="n">kpts</span>     <span class="o">=</span> <span class="n">kpath_bounds</span><span class="p">,</span>
                   <span class="n">comment</span>  <span class="o">=</span> <span class="n">comment</span> <span class="k">if</span> <span class="n">comment</span> <span class="k">else</span> <span class="s">&quot;K-Path scheme&quot;</span><span class="p">,</span>
                  <span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.path_from_structure"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.path_from_structure">[docs]</a>    <span class="k">def</span> <span class="nf">path_from_structure</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ndivsm</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="s">&quot;See _path for the meaning of the variables&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_path</span><span class="p">(</span><span class="n">ndivsm</span><span class="p">,</span>  <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&quot;K-path generated automatically from pymatgen structure&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.explicit_path"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.explicit_path">[docs]</a>    <span class="k">def</span> <span class="nf">explicit_path</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ndivsm</span><span class="p">,</span> <span class="n">kpath_bounds</span><span class="p">):</span>
        <span class="s">&quot;See _path for the meaning of the variables&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_path</span><span class="p">(</span><span class="n">ndivsm</span><span class="p">,</span> <span class="n">kpath_bounds</span><span class="o">=</span><span class="n">kpath_bounds</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&quot;Explicit K-path&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="KSampling.automatic_density"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.automatic_density">[docs]</a>    <span class="k">def</span> <span class="nf">automatic_density</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">kppa</span><span class="p">,</span> <span class="n">chksymbreak</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_symmetries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_time_reversal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an automatic Kpoint object based on a structure and a kpoint</span>
<span class="sd">        density. Uses Gamma centered meshes for hexagonal cells and Monkhorst-Pack grids otherwise.</span>

<span class="sd">        Algorithm:</span>
<span class="sd">            Uses a simple approach scaling the number of divisions along each</span>
<span class="sd">            reciprocal lattice vector proportional to its length.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure:</span>
<span class="sd">                Input structure</span>
<span class="sd">            kppa:</span>
<span class="sd">                Grid density</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">abc</span>
        <span class="n">ngrid</span> <span class="o">=</span> <span class="n">kppa</span> <span class="o">/</span> <span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span>

        <span class="n">mult</span> <span class="o">=</span> <span class="p">(</span><span class="n">ngrid</span> <span class="o">*</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>

        <span class="n">num_div</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mult</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="c"># ensure that num_div[i] &gt; 0</span>
        <span class="n">num_div</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_div</span><span class="p">]</span>

        <span class="n">angles</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">angles</span>
        <span class="n">hex_angle_tol</span> <span class="o">=</span> <span class="mi">5</span>      <span class="c"># in degrees</span>
        <span class="n">hex_length_tol</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c"># in angstroms</span>

        <span class="n">right_angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">hex_angle_tol</span><span class="p">]</span>

        <span class="n">hex_angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                      <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">hex_angle_tol</span> <span class="ow">or</span>
                      <span class="nb">abs</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">120</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">hex_angle_tol</span><span class="p">]</span>

        <span class="n">is_hexagonal</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right_angles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hex_angles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="n">right_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span>
                                <span class="n">lengths</span><span class="p">[</span><span class="n">right_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">&lt;</span> <span class="n">hex_length_tol</span><span class="p">)</span>

        <span class="c">#style = Kpoints.modes.gamma</span>
        <span class="c">#if not is_hexagonal:</span>
        <span class="c">#    num_div = [i + i % 2 for i in num_div]</span>
        <span class="c">#    style = Kpoints.modes.monkhorst</span>

        <span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;pymatgen generated KPOINTS with grid density = &quot;</span> <span class="o">+</span> <span class="s">&quot;{} / atom&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kppa</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">mode</span>              <span class="o">=</span> <span class="s">&quot;monkhorst&quot;</span><span class="p">,</span>
                   <span class="n">num_kpts</span>          <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">kpts</span>              <span class="o">=</span> <span class="p">[</span><span class="n">num_div</span><span class="p">],</span>
                   <span class="n">kpt_shifts</span>        <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                   <span class="n">chksymbreak</span>       <span class="o">=</span> <span class="n">chksymbreak</span><span class="p">,</span>
                   <span class="n">use_symmetries</span>    <span class="o">=</span> <span class="n">use_symmetries</span>   <span class="p">,</span>
                   <span class="n">use_time_reversal</span> <span class="o">=</span> <span class="n">use_time_reversal</span><span class="p">,</span>
                   <span class="n">comment</span>           <span class="o">=</span> <span class="n">comment</span><span class="p">,</span>
                  <span class="p">)</span>
</div>
<div class="viewcode-block" id="KSampling.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.KSampling.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span>


</div></div>
<div class="viewcode-block" id="Constraints"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Constraints">[docs]</a><span class="k">class</span> <span class="nc">Constraints</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This object defines the constraints for structural relaxation&quot;&quot;&quot;</span>
<div class="viewcode-block" id="Constraints.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Constraints.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="RelaxationMethod"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.RelaxationMethod">[docs]</a><span class="k">class</span> <span class="nc">RelaxationMethod</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object stores the variables for the (constrained) structural optimization</span>
<span class="sd">    ionmov and optcell specify the type of relaxation.</span>
<span class="sd">    The other variables are optional and their use depend on ionmov and optcell.</span>
<span class="sd">    A None value indicates that we use abinit default. Default values can</span>
<span class="sd">    be modified by passing them to the constructor.</span>
<span class="sd">    The set of variables are constructed in to_abivars depending on ionmov and optcell.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_vars</span> <span class="o">=</span>  <span class="p">{</span>
        <span class="s">&quot;ionmov&quot;</span>           <span class="p">:</span> <span class="n">MANDATORY</span><span class="p">,</span>
        <span class="s">&quot;optcell&quot;</span>          <span class="p">:</span> <span class="n">MANDATORY</span><span class="p">,</span>
        <span class="s">&quot;ntime&quot;</span>            <span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
        <span class="s">&quot;dilatmx&quot;</span>          <span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
        <span class="s">&quot;ecutsm&quot;</span>           <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s">&quot;strfact&quot;</span>          <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;tolmxf&quot;</span>           <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;strtarget&quot;</span>        <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;atoms_constraints&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="c"># Constraints are stored in a dictionary. {} means if no constraint is enforced.</span>
    <span class="p">}</span>

    <span class="n">IONMOV_DEFAULT</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">OPTCELL_DEFAULT</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c"># Initialize abivars with the default values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_vars</span>

        <span class="c"># Overwrite the keys with the args and kwargs passed to constructor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abivars</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_vars</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: No default value has been provided for key </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">abivars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="n">MANDATORY</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: No default value has been provided for the mandatory key </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RelaxationMethod.atoms_only"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.RelaxationMethod.atoms_only">[docs]</a>    <span class="k">def</span> <span class="nf">atoms_only</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">atoms_constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">atoms_constraints</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">ionmov</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">IONMOV_DEFAULT</span><span class="p">,</span> <span class="n">optcell</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">ionmov</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">IONMOV_DEFAULT</span><span class="p">,</span> <span class="n">optcell</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atoms_constraints</span><span class="o">=</span><span class="n">atoms_constraints</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RelaxationMethod.atoms_and_cell"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.RelaxationMethod.atoms_and_cell">[docs]</a>    <span class="k">def</span> <span class="nf">atoms_and_cell</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">atoms_constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">atoms_constraints</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">ionmov</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">IONMOV_DEFAULT</span><span class="p">,</span> <span class="n">optcell</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">OPTCELL_DEFAULT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">ionmov</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">IOMOV_DEFAULT</span><span class="p">,</span> <span class="n">optcell</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">OPTCELL_DEFAULT</span><span class="p">,</span> <span class="n">atoms_constraints</span><span class="o">=</span><span class="n">atoms_constraints</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="RelaxationMethod.move_atoms"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.RelaxationMethod.move_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">move_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if atoms must be moved.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">ionmov</span> <span class="o">!=</span> <span class="mi">0</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="RelaxationMethod.move_cell"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.RelaxationMethod.move_cell">[docs]</a>    <span class="k">def</span> <span class="nf">move_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if lattice parameters must be optimized.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">optcell</span> <span class="o">!=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="RelaxationMethod.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.RelaxationMethod.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary with the abinit variables&quot;&quot;&quot;</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>

        <span class="c"># These variables are always present.</span>
        <span class="n">abivars</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;ionmov&quot;</span> <span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">ionmov</span><span class="p">,</span>
            <span class="s">&quot;optcell&quot;</span><span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">optcell</span><span class="p">,</span>
            <span class="s">&quot;ntime&quot;</span>  <span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">ntime</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c"># Atom relaxation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_atoms</span><span class="p">:</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s">&quot;tolmxf&quot;</span><span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">tolmxf</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="k">if</span> <span class="nb">vars</span><span class="o">.</span><span class="n">atoms_constraints</span><span class="p">:</span>
            <span class="c"># Add input variables for constrained relaxation.</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="o">.</span><span class="n">atoms_constraints</span><span class="o">.</span><span class="n">to_abivars</span><span class="p">())</span>

        <span class="c"># Cell relaxation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_cell</span><span class="p">:</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s">&quot;dilatmx&quot;</span>  <span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">dilatmx</span><span class="p">,</span>
                <span class="s">&quot;ecutsm&quot;</span>   <span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">ecutsm</span><span class="p">,</span>
                <span class="s">&quot;strfact&quot;</span>  <span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">strfact</span><span class="p">,</span>
                <span class="s">&quot;strtarget&quot;</span><span class="p">:</span> <span class="nb">vars</span><span class="o">.</span><span class="n">strtarget</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">abivars</span>

</div></div>
<div class="viewcode-block" id="PPModel"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.PPModel">[docs]</a><span class="k">class</span> <span class="nc">PPModel</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">,</span> <span class="n">MSONable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters defining the plasmon-pole technique.</span>
<span class="sd">    The common way to instanciate a PPModel object is via the class method</span>
<span class="sd">    PPModel.asppmodel(string)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_mode2ppmodel</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;noppmodel&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;godby&quot;</span>    <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&quot;hybersten&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">&quot;linden&quot;</span>   <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s">&quot;farid&quot;</span>    <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">modes</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_mode2ppmodel</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="PPModel.asppmodel"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.PPModel.asppmodel">[docs]</a>    <span class="k">def</span> <span class="nf">asppmodel</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs an instance of PPModel from obj.</span>

<span class="sd">        Accepts obj in the form:</span>
<span class="sd">            * PPmodel instance</span>
<span class="sd">            * string. e.g &quot;godby:12.3 eV&quot;, &quot;linden&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="c"># obj is a string</span>
        <span class="k">if</span> <span class="s">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">mode</span><span class="p">,</span> <span class="n">plasmon_freq</span> <span class="o">=</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Extract mode and plasmon_freq</span>
            <span class="n">mode</span><span class="p">,</span> <span class="n">plasmon_freq</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">plasmon_freq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plasmon_freq</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">plasmon_freq</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">plasmon_freq</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">plasmon_freq</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">Energy</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">plasmon_freq</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s">&quot;Ha&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">plasmon_freq</span><span class="o">=</span><span class="n">plasmon_freq</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;godby&quot;</span><span class="p">,</span> <span class="n">plasmon_freq</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">PPModel</span><span class="o">.</span><span class="n">modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plasmon_freq</span> <span class="o">=</span> <span class="n">plasmon_freq</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasmon_freq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">plasmon_freq</span> <span class="ow">is</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plasmon_freq</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">plasmon_freq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s">&quot;noppmodel&quot;</span>

    <span class="c"># py2 old version</span>
    <span class="n">__nonzero__</span> <span class="o">=</span> <span class="n">__bool__</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">, mode = </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                                          <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span>

<div class="viewcode-block" id="PPModel.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.PPModel.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&quot;ppmodel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode2ppmodel</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">],</span>
                    <span class="s">&quot;ppmfrq&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasmon_freq</span><span class="p">,}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="PPModel.noppmodel"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.PPModel.noppmodel">[docs]</a>    <span class="k">def</span> <span class="nf">noppmodel</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;noppmodel&quot;</span><span class="p">,</span> <span class="n">plasmon_freq</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PPModel.to_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.PPModel.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s">&quot;plasmon_freq&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasmon_freq</span><span class="p">,</span>
                <span class="s">&quot;@module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
                <span class="s">&quot;@class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">}</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PPModel.from_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.PPModel.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PPModel</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;mode&quot;</span><span class="p">],</span> <span class="n">plasmon_freq</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;plasmon_freq&quot;</span><span class="p">])</span>


</div></div>
<div class="viewcode-block" id="HilbertTransform"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.HilbertTransform">[docs]</a><span class="k">class</span> <span class="nc">HilbertTransform</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters for the Hilbert-transform method (Screening code)</span>
<span class="sd">    i.e. the parameters defining the frequency mesh used for the spectral function</span>
<span class="sd">    and the frequency mesh used for the polarizability</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nomegasf</span><span class="p">,</span> <span class="n">domegasf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spmeth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfreqre</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">freqremax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nfreqim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">freqremin</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            nomegasf:</span>
<span class="sd">                Number of points for sampling the spectral function along the real axis.</span>
<span class="sd">            domegasf:</span>
<span class="sd">                Step in Ha for the linear mesh used for the spectral function.</span>
<span class="sd">            spmeth:</span>
<span class="sd">                Algorith for the representation of the delta function.</span>
<span class="sd">            nfreqre:</span>
<span class="sd">                Number of points along the real axis (linear mesh).</span>
<span class="sd">            freqremax:</span>
<span class="sd">                Maximum frequency for W along the real axis (in hartree).</span>
<span class="sd">            nfreqim:</span>
<span class="sd">                Number of point along the imaginary axis (Gauss-Legendre mesh).</span>
<span class="sd">            freqremin:</span>
<span class="sd">                Minimum frequency for W along the real axis (in hartree).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Spectral function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nomegasf</span> <span class="o">=</span> <span class="n">nomegasf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domegasg</span> <span class="o">=</span> <span class="n">domegasf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spmeth</span>   <span class="o">=</span> <span class="n">spmeth</span>

        <span class="c"># Mesh for the contour-deformation method used for the integration of the self-energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfreqre</span> <span class="o">=</span> <span class="n">nfreqre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqremax</span> <span class="o">=</span> <span class="n">freqremax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqremin</span> <span class="o">=</span> <span class="n">freqremin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfreqim</span> <span class="o">=</span> <span class="n">nfreqim</span>

<div class="viewcode-block" id="HilbertTransform.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.HilbertTransform.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary with the abinit variables&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
                <span class="c"># Spectral function</span>
                <span class="s">&quot;nomegasf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nomegasf</span><span class="p">,</span>
                <span class="s">&quot;domegasf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domegasf</span><span class="p">,</span>
                <span class="s">&quot;spmeth&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spmeth</span><span class="p">,</span>
                 <span class="c"># Frequency mesh for the polarizability</span>
                <span class="s">&quot;nfreqre&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfreqre</span><span class="p">,</span>
                <span class="s">&quot;freqremax&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqremax</span><span class="p">,</span>
                <span class="s">&quot;nfreqim&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfreqim</span><span class="p">,</span>
                <span class="s">&quot;freqremin&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqremin</span><span class="p">,</span>
                <span class="p">}</span>

</div></div>
<div class="viewcode-block" id="ModelDielectricFunction"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ModelDielectricFunction">[docs]</a><span class="k">class</span> <span class="nc">ModelDielectricFunction</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model dielectric function used for BSE calculation&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdf_epsinf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdf_epsinf</span> <span class="o">=</span> <span class="n">mdf_epsinf</span>

<div class="viewcode-block" id="ModelDielectricFunction.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ModelDielectricFunction.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;mdf_epsinf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdf_epsinf</span><span class="p">}</span>

<span class="c">##########################################################################################</span>
<span class="c">#################################  WORK IN PROGRESS ######################################</span>
<span class="c">##########################################################################################</span>

</div></div>
<div class="viewcode-block" id="Screening"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Screening">[docs]</a><span class="k">class</span> <span class="nc">Screening</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object defines the parameters used for the</span>
<span class="sd">    computation of the screening function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Approximations used for W</span>
    <span class="n">_WTYPES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;RPA&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c"># Self-consistecy modes</span>
    <span class="n">_SC_MODES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;one_shot&quot;</span>     <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;energy_only&quot;</span>  <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&quot;wavefunctions&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ecuteps</span><span class="p">,</span> <span class="n">nband</span><span class="p">,</span> <span class="n">w_type</span><span class="o">=</span><span class="s">&quot;RPA&quot;</span><span class="p">,</span> <span class="n">sc_mode</span><span class="o">=</span><span class="s">&quot;one_shot&quot;</span><span class="p">,</span>
                 <span class="n">hilbert</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ecutwfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inclvkb</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            ecuteps:</span>
<span class="sd">                Cutoff energy for the screening (Ha units).</span>
<span class="sd">            nband</span>
<span class="sd">                Number of bands for the Green&#39;s function</span>
<span class="sd">            w_type:</span>
<span class="sd">                Screening type</span>
<span class="sd">            sc_mode:</span>
<span class="sd">                Self-consistency mode.</span>
<span class="sd">            hilbert:</span>
<span class="sd">                Instance of `HilbertTransform` defining the paramentes for the Hilber transform method.</span>
<span class="sd">            ecutwfn:</span>
<span class="sd">                Cutoff energy for the wavefunctions (Default: ecutwfn == ecut).</span>
<span class="sd">            inclvkb=2</span>
<span class="sd">                Option for the treatment of the dipole matrix elements (NC pseudos).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">w_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_WTYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;W_TYPE: </span><span class="si">%s</span><span class="s"> is not supported&quot;</span> <span class="o">%</span> <span class="n">w_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sc_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SC_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Self-consistecy mode </span><span class="si">%s</span><span class="s"> is not supported&quot;</span> <span class="o">%</span> <span class="n">sc_mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ecuteps</span> <span class="o">=</span> <span class="n">ecuteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nband</span>   <span class="o">=</span> <span class="n">nband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_type</span>  <span class="o">=</span> <span class="n">w_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc_mode</span> <span class="o">=</span> <span class="n">sc_mode</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ecutwfn</span> <span class="o">=</span> <span class="n">ecutwfn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inclvkb</span> <span class="o">=</span> <span class="n">inclvkb</span>

        <span class="k">if</span> <span class="n">hilbert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Hilber transform not coded yet&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hilbert</span> <span class="o">=</span> <span class="n">hilbert</span>

        <span class="c"># Default values</span>
        <span class="c"># TODO Change abinit defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gwpara</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awtr</span>   <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symchi</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Screening.use_hilbert"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Screening.use_hilbert">[docs]</a>    <span class="k">def</span> <span class="nf">use_hilbert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;hilbert&quot;</span><span class="p">)</span>

    <span class="c">#@property</span>
    <span class="c">#def gwcalctyp(self):</span>
    <span class="c">#    &quot;Return the value of the gwcalctyp input variable&quot;</span>
    <span class="c">#    dig0 = str(self._SIGMA_TYPES[self.type])</span>
    <span class="c">#    dig1 = str(self._SC_MODES[self.sc_mode])</span>
    <span class="c">#    return dig1.strip() + dig0.strip()</span>
</div>
<div class="viewcode-block" id="Screening.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.Screening.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns a dictionary with the abinit variables&quot;</span>
        <span class="n">abivars</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;ecuteps&quot;</span>   <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecuteps</span><span class="p">,</span>
            <span class="s">&quot;ecutwfn&quot;</span>   <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecutwfn</span><span class="p">,</span>
            <span class="s">&quot;inclvkb&quot;</span>   <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inclvkb</span><span class="p">,</span>
            <span class="s">&quot;gwpara&quot;</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gwpara</span><span class="p">,</span>
            <span class="s">&quot;awtr&quot;</span>      <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">awtr</span><span class="p">,</span>
            <span class="s">&quot;symchi&quot;</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symchi</span><span class="p">,</span>
            <span class="c">#&quot;gwcalctyp&quot;: self.gwcalctyp,</span>
            <span class="c">#&quot;fftgw&quot;    : self.fftgw,</span>
        <span class="p">}</span>

        <span class="c"># Variables for the Hilber transform.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_hilbert</span><span class="p">:</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hilbert</span><span class="o">.</span><span class="n">to_abivars</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">abivars</span>

</div></div>
<div class="viewcode-block" id="SelfEnergy"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SelfEnergy">[docs]</a><span class="k">class</span> <span class="nc">SelfEnergy</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object defines the parameters used for the</span>
<span class="sd">    computation of the self-energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_SIGMA_TYPES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;gw&quot;</span>          <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;hartree_fock&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s">&quot;sex&quot;</span>         <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s">&quot;cohsex&quot;</span>      <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s">&quot;model_gw_ppm&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s">&quot;model_gw_cd&quot;</span> <span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_SC_MODES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;one_shot&quot;</span>     <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;energy_only&quot;</span>  <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&quot;wavefunctions&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">se_type</span><span class="p">,</span> <span class="n">sc_mode</span><span class="p">,</span> <span class="n">nband</span><span class="p">,</span> <span class="n">ecutsigx</span><span class="p">,</span> <span class="n">screening</span><span class="p">,</span>
                 <span class="n">gw_qprange</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ppmodel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ecuteps</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ecutwfn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            se_type:</span>
<span class="sd">                Type of self-energy (str)</span>
<span class="sd">            sc_mode:</span>
<span class="sd">                Self-consistency mode.</span>
<span class="sd">            nband</span>
<span class="sd">                Number of bands for the Green&#39;s function</span>
<span class="sd">            ecutsigx:</span>
<span class="sd">                Cutoff energy for the exchange part of the self-energy (Ha units).</span>
<span class="sd">            screening:</span>
<span class="sd">                `Screening` instance.</span>
<span class="sd">            gw_qprange:</span>
<span class="sd">                Option for the automatic selection of k-points and bands for GW corrections.</span>
<span class="sd">                See Abinit docs for more detail. The default value makes the code computie the</span>
<span class="sd">                QP energies for all the point in the IBZ and one band above and one band below the Fermi level.</span>
<span class="sd">            ppmodel:</span>
<span class="sd">                `PPModel` instance with the parameters used for the plasmon-pole technique.</span>
<span class="sd">            ecuteps:</span>
<span class="sd">                Cutoff energy for the screening (Ha units).</span>
<span class="sd">            ecutwfn:</span>
<span class="sd">                Cutoff energy for the wavefunctions (Default: ecutwfn == ecut).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">se_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SIGMA_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;SIGMA_TYPE: </span><span class="si">%s</span><span class="s"> is not supported&quot;</span> <span class="o">%</span> <span class="n">se_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sc_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SC_MODES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Self-consistecy mode </span><span class="si">%s</span><span class="s"> is not supported&quot;</span> <span class="o">%</span> <span class="n">sc_mode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span>      <span class="o">=</span> <span class="n">se_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc_mode</span>   <span class="o">=</span> <span class="n">sc_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nband</span>     <span class="o">=</span> <span class="n">nband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecutsigx</span>  <span class="o">=</span> <span class="n">ecutsigx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screening</span> <span class="o">=</span> <span class="n">screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gw_qprange</span> <span class="o">=</span> <span class="n">gw_qprange</span>

        <span class="k">if</span> <span class="n">ppmodel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">screening</span><span class="o">.</span><span class="n">use_hilbert</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ppmodel</span> <span class="o">=</span> <span class="n">PPModel</span><span class="o">.</span><span class="n">asppmodel</span><span class="p">(</span><span class="n">ppmodel</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ecuteps</span> <span class="o">=</span> <span class="n">ecuteps</span> <span class="k">if</span> <span class="n">ecuteps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">screening</span><span class="o">.</span><span class="n">ecuteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecutwfn</span> <span class="o">=</span> <span class="n">ecutwfn</span>

        <span class="c">#band_mode in [&quot;gap&quot;, &quot;full&quot;]</span>

        <span class="c">#if isinstance(kptgw, str) and kptgw == &quot;all&quot;:</span>
        <span class="c">#    self.kptgw = None</span>
        <span class="c">#    self.nkptgw = None</span>
        <span class="c">#else:</span>
        <span class="c">#    self.kptgw = np.reshape(kptgw, (-1,3))</span>
        <span class="c">#    self.nkptgw =  len(self.kptgw)</span>

        <span class="c">#if bdgw is None:</span>
        <span class="c">#    raise ValueError(&quot;bdgw must be specified&quot;)</span>

        <span class="c">#if isinstance(bdgw, str):</span>
        <span class="c">#    # TODO add new variable in Abinit so that we can specify</span>
        <span class="c">#    # an energy interval around the KS gap.</span>
        <span class="c">#    homo = float(nele) / 2.0</span>
        <span class="c">#    #self.bdgw =</span>

        <span class="c">#else:</span>
        <span class="c">#    self.bdgw = np.reshape(bdgw, (-1,2))</span>

        <span class="c">#self.freq_int = freq_int</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="SelfEnergy.use_ppmodel"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SelfEnergy.use_ppmodel">[docs]</a>    <span class="k">def</span> <span class="nf">use_ppmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if we are using the plasmon-pole approximation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;ppmodel&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="SelfEnergy.gwcalctyp"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SelfEnergy.gwcalctyp">[docs]</a>    <span class="k">def</span> <span class="nf">gwcalctyp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of the gwcalctyp input variable.&quot;&quot;&quot;</span>
        <span class="n">dig0</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SIGMA_TYPES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">])</span>
        <span class="n">dig1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SC_MODES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sc_mode</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dig1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">dig0</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="SelfEnergy.symsigma"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SelfEnergy.symsigma">[docs]</a>    <span class="k">def</span> <span class="nf">symsigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;1 if symmetries can be used to reduce the number of q-points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_mode</span> <span class="o">==</span> <span class="s">&quot;one_shot&quot;</span> <span class="k">else</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="SelfEnergy.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.SelfEnergy.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns a dictionary with the abinit variables&quot;</span>

        <span class="n">abivars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">gwcalctyp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gwcalctyp</span><span class="p">,</span>
            <span class="n">ecuteps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecuteps</span><span class="p">,</span>
            <span class="n">ecutsigx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecutsigx</span><span class="p">,</span>
            <span class="n">symsigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symsigma</span><span class="p">,</span>
            <span class="n">gw_qprange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gw_qprange</span><span class="p">,</span>
            <span class="c">#&quot;ecutwfn&quot;  : self.ecutwfn,</span>
            <span class="c">#&quot;kptgw&quot;    : self.kptgw,</span>
            <span class="c">#&quot;nkptgw&quot;   : self.nkptgw,</span>
            <span class="c">#&quot;bdgw&quot;     : self.bdgw,</span>
        <span class="p">)</span>

        <span class="c"># FIXME: problem with the spin</span>
        <span class="c">#assert len(self.bdgw) == self.nkptgw</span>

        <span class="c"># ppmodel variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ppmodel</span><span class="p">:</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppmodel</span><span class="o">.</span><span class="n">to_abivars</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">abivars</span>

</div></div>
<div class="viewcode-block" id="ExcHamiltonian"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ExcHamiltonian">[docs]</a><span class="k">class</span> <span class="nc">ExcHamiltonian</span><span class="p">(</span><span class="n">AbivarAble</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This object contains the parameters for the solution of the Bethe-Salpeter equation.&quot;&quot;&quot;</span>
    <span class="c"># Types of excitonic Hamiltonian.</span>
    <span class="n">_EXC_TYPES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;TDA&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>          <span class="c"># Tamm-Dancoff approximation.</span>
        <span class="s">&quot;coupling&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>     <span class="c"># Calculation with coupling.</span>
    <span class="p">}</span>

    <span class="c"># Algorithms used to compute the macroscopic dielectric function</span>
    <span class="c"># and/or the exciton wavefunctions.</span>
    <span class="n">_ALGO2VAR</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;direct_diago&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&quot;haydock&quot;</span>     <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">&quot;cg&quot;</span>          <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c"># Options specifying the treatment of the Coulomb term.</span>
    <span class="n">_COULOMB_MODES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&quot;diago&quot;</span><span class="p">,</span>
        <span class="s">&quot;full&quot;</span><span class="p">,</span>
        <span class="s">&quot;model_df&quot;</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bs_loband</span><span class="p">,</span> <span class="n">nband</span><span class="p">,</span> <span class="n">soenergy</span><span class="p">,</span> <span class="n">coulomb_mode</span><span class="p">,</span> <span class="n">ecuteps</span><span class="p">,</span> <span class="n">spin_mode</span><span class="o">=</span><span class="s">&quot;polarized&quot;</span><span class="p">,</span> <span class="n">mdf_epsinf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">exc_type</span><span class="o">=</span><span class="s">&quot;TDA&quot;</span><span class="p">,</span> <span class="n">algo</span><span class="o">=</span><span class="s">&quot;haydock&quot;</span><span class="p">,</span> <span class="n">with_lf</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bs_freq_mesh</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">zcut</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            bs_loband:</span>
<span class="sd">                Lowest band index used in the e-h  basis set. Can be scalar or array of shape (nsppol,)</span>
<span class="sd">            nband:</span>
<span class="sd">                Max band index used in the e-h  basis set.</span>
<span class="sd">            soenergy:</span>
<span class="sd">                Scissors energy in Hartree.</span>
<span class="sd">            coulomb_mode:</span>
<span class="sd">                Treatment of the Coulomb term.</span>
<span class="sd">            ecuteps:</span>
<span class="sd">                Cutoff energy for W in Hartree.</span>
<span class="sd">            mdf_epsinf:</span>
<span class="sd">                Macroscopic dielectric function :math:`\epsilon_\inf` used in</span>
<span class="sd">                the model dielectric function.</span>
<span class="sd">            exc_type:</span>
<span class="sd">                Approximation used for the BSE Hamiltonian</span>
<span class="sd">            with_lf:</span>
<span class="sd">                True if local field effects are included &lt;==&gt; exchange term is included</span>
<span class="sd">            bs_freq_mesh:</span>
<span class="sd">                Frequency mesh for the macroscopic dielectric function (start, stop, step) in Ha.</span>
<span class="sd">            zcut:</span>
<span class="sd">                Broadening parameter in Ha.</span>
<span class="sd">            **kwargs:</span>
<span class="sd">                Extra keywords</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spin_mode</span> <span class="o">=</span> <span class="n">SpinMode</span><span class="o">.</span><span class="n">asspinmode</span><span class="p">(</span><span class="n">spin_mode</span><span class="p">)</span>

        <span class="c"># We want an array bs_loband(nsppol).</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bs_loband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">bs_loband</span><span class="p">,</span> <span class="p">(</span><span class="n">spin_mode</span><span class="o">.</span><span class="n">nsppol</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">bs_loband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spin_mode</span><span class="o">.</span><span class="n">nsppol</span> <span class="o">*</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">bs_loband</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bs_loband</span> <span class="o">=</span> <span class="n">bs_loband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nband</span>  <span class="o">=</span> <span class="n">nband</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soenergy</span> <span class="o">=</span> <span class="n">soenergy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb_mode</span> <span class="o">=</span> <span class="n">coulomb_mode</span>
        <span class="k">assert</span> <span class="n">coulomb_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_COULOMB_MODES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecuteps</span> <span class="o">=</span> <span class="n">ecuteps</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mdf_epsinf</span> <span class="o">=</span> <span class="n">mdf_epsinf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exc_type</span> <span class="o">=</span> <span class="n">exc_type</span>
        <span class="k">assert</span> <span class="n">exc_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EXC_TYPES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">=</span> <span class="n">algo</span>
        <span class="k">assert</span> <span class="n">algo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALGO2VAR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_lf</span> <span class="o">=</span> <span class="n">with_lf</span>

        <span class="c"># if bs_freq_mesh is not given, abinit will select its own mesh.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bs_freq_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bs_freq_mesh</span><span class="p">)</span> <span class="k">if</span> <span class="n">bs_freq_mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">bs_freq_mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zcut</span> <span class="o">=</span> <span class="n">zcut</span>

        <span class="c"># Extra options.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">if</span> <span class="s">&quot;chksymbreak&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;chksymbreak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="ExcHamiltonian.inclvkb"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ExcHamiltonian.inclvkb">[docs]</a>    <span class="k">def</span> <span class="nf">inclvkb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Treatment of the dipole matrix element (NC pseudos, default is 2)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;inclvkb&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="ExcHamiltonian.use_haydock"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ExcHamiltonian.use_haydock">[docs]</a>    <span class="k">def</span> <span class="nf">use_haydock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if we are using the Haydock iterative technique.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s">&quot;haydock&quot;</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="ExcHamiltonian.use_cg"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ExcHamiltonian.use_cg">[docs]</a>    <span class="k">def</span> <span class="nf">use_cg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if we are using the conjugate gradient method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s">&quot;cg&quot;</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="ExcHamiltonian.use_direct_diago"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ExcHamiltonian.use_direct_diago">[docs]</a>    <span class="k">def</span> <span class="nf">use_direct_diago</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if we are performing the direct diagonalization of the BSE Hamiltonian.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s">&quot;direct_diago&quot;</span>
</div>
<div class="viewcode-block" id="ExcHamiltonian.to_abivars"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.abiobjects.ExcHamiltonian.to_abivars">[docs]</a>    <span class="k">def</span> <span class="nf">to_abivars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary with the abinit variables.&quot;&quot;&quot;</span>

        <span class="n">abivars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">bs_calctype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">bs_loband</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bs_loband</span><span class="p">,</span>
            <span class="n">nband</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">,</span>
            <span class="n">soenergy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">soenergy</span><span class="p">,</span>
            <span class="n">ecuteps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ecuteps</span><span class="p">,</span>
            <span class="c">#bs_algorithm = self._ALGO2VAR[self.algo],</span>
            <span class="n">bs_coulomb_term</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span>
            <span class="n">mdf_epsinf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mdf_epsinf</span><span class="p">,</span>
            <span class="n">bs_exchange_term</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_lf</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">inclvkb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inclvkb</span><span class="p">,</span>
            <span class="n">zcut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zcut</span><span class="p">,</span>
            <span class="n">bs_freq_mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bs_freq_mesh</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_haydock</span><span class="p">:</span>
            <span class="c"># FIXME</span>
            <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">bs_haydock_niter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>      <span class="c"># No. of iterations for Haydock</span>
                <span class="n">bs_hayd_term</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>            <span class="c"># No terminator</span>
                <span class="n">bs_haydock_tol</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c"># Stopping criteria</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_direct_diago</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown algorithm for EXC: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="p">)</span>

        <span class="c"># Add extra kwargs</span>
        <span class="n">abivars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">abivars</span>


<span class="c">#class Perturbation(AbivarAble):</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    Base class for perturbations: a base perturbation is essentially defined</span>
<span class="c">#    by a q-point in reduced coordinates.</span>
<span class="c">#</span>
<span class="c">#    Subclasses should extend the base method `to_abivars` and provide the method `suggested_kptopt`</span>
<span class="c">#    that returns the value of kptopt that can be used to sample the Brillouin zone.</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    def __init__(self, qpt):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        Args:</span>
<span class="c">#            qpt:</span>
<span class="c">#                reduced coordinates of the q-point associated to the perturbation.</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        self.qpt = np.reshape(qpt, (-1,3))</span>
<span class="c">#        self.nqpt = len(self.qpt)</span>
<span class="c">#</span>
<span class="c">#    @property</span>
<span class="c">#    def qpt_is_gamma(self):</span>
<span class="c">#        &quot;&quot;&quot;True if the q-point of the perturbation is Gamma.&quot;&quot;&quot;</span>
<span class="c">#        return np.all(np.abs(self.qpt) &lt; 1.e-6)</span>
<span class="c">#</span>
<span class="c">#    @abc.abstractproperty</span>
<span class="c">#    def suggested_kptopt(self):</span>
<span class="c">#        &quot;&quot;&quot;Returns the suggested value of kptopt to use for this perturbation.&quot;&quot;&quot;</span>
<span class="c">#        return 3</span>
<span class="c">#</span>
<span class="c">#    def to_abivars(self):</span>
<span class="c">#        return dict(nqpt=1, qpt=self.qpt)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#class IFC(AbivarAble):</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    This object defines the set of variables used for the</span>
<span class="c">#    Fourier interpolation of the interatomic force constants.</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    def __init__(self, ddb_filename, ngqpt, q1shfts=(0.,0.,0.), ifcflag=1, brav=1):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        For the complete description of the meaning of the variables see anaddb_help.html</span>
<span class="c">#</span>
<span class="c">#        Args:</span>
<span class="c">#            ddb_filename:</span>
<span class="c">#                Path to the DDB file.</span>
<span class="c">#            ngqpt:</span>
<span class="c">#                Monkhorst-Pack divisions.</span>
<span class="c">#            q1shfts:</span>
<span class="c">#                Monkhorst-Pack shifts.</span>
<span class="c">#            ifcflag:</span>
<span class="c">#                Interatomic force constant flag.</span>
<span class="c">#            brav:</span>
<span class="c">#                Bravais Lattice: 1-S.C., 2-F.C., 3-B.C., 4-Hex.</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        self.ddb_filename = os.path.abspath(ddb_filename)</span>
<span class="c">#        if not os.path.exists(self.ddb_filename):</span>
<span class="c">#            raise ValueError(&quot;%s: no such file&quot; % self.ddb_filename)</span>
<span class="c">#</span>
<span class="c">#        self.ifcflag = ifcflag</span>
<span class="c">#        self.brav = brav</span>
<span class="c">#        self.ngqpt = ngqpt</span>
<span class="c">#</span>
<span class="c">#        self.q1shft = np.reshape(q1shft, (-1,3))</span>
<span class="c">#        self.nqshft = len(self.q1shft)</span>
<span class="c">#</span>
<span class="c">#    def to_abivars(self):</span>
<span class="c">#        d = dict(</span>
<span class="c">#            ifcflag=self.ifcflag,</span>
<span class="c">#            brav=self.brav,</span>
<span class="c">#            ngqpt=&quot;%d %d %d&quot; % tuple(q for q in self.ngqpt),</span>
<span class="c">#            nqshft=self.nqshft,</span>
<span class="c">#            )</span>
<span class="c">#</span>
<span class="c">#        lines = []</span>
<span class="c">#        for shift in self.q1shfts:</span>
<span class="c">#            lines.append(&quot;%f %f %f&quot; % tuple(c for c in shift))</span>
<span class="c">#        d[&quot;q1shfts&quot;] = &quot;\n&quot;.join(lines)</span>
<span class="c">#</span>
<span class="c">#        return d</span>
<span class="c">#</span>
<span class="c">#    def fourier_interpol(self, qpath=None, qmesh=None, symdynmat=1, asr=1, chneut=1, dipdip=1,</span>
<span class="c">#                         executable=None, verbose=0):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        Fourier interpolation of the IFCs.</span>
<span class="c">#</span>
<span class="c">#        Args:</span>
<span class="c">#            asr:</span>
<span class="c">#                Acoustic Sum Rule. 1 to impose it asymetrically.</span>
<span class="c">#            chneut:</span>
<span class="c">#                Charge neutrality requirement for effective charges.</span>
<span class="c">#            dipdip:</span>
<span class="c">#                Dipole-dipole interaction treatment.</span>
<span class="c">#            symdinmat:</span>
<span class="c">#                TODO</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        # Build input for anaddb. Variables are stored in the dict d.</span>
<span class="c">#        d = {</span>
<span class="c">#            &quot;symdynmat&quot;: symdynmat,</span>
<span class="c">#            &quot;asr&quot;      : asr,</span>
<span class="c">#            &quot;chneut&quot;   : chneut,</span>
<span class="c">#            &quot;dipdip&quot;   : dipdip,</span>
<span class="c">#        }</span>
<span class="c">#</span>
<span class="c">#        # Phonon band structure.</span>
<span class="c">#        if qpath is not None:</span>
<span class="c">#            qpath = np.reshape(qpath, (-1,3))</span>
<span class="c">#            d.update({</span>
<span class="c">#                &quot;nqpath&quot;: len(qpath),</span>
<span class="c">#                &quot;qpath&quot; : &quot;\n&quot;.join(&quot;%f %f %f&quot; % tuple(q) for q in qpath),</span>
<span class="c">#            })</span>
<span class="c">#</span>
<span class="c">#        # Phonon DOS calculations.</span>
<span class="c">#        # TODO</span>
<span class="c">#        #if qmesh is not None:</span>
<span class="c">#        #    d.update({</span>
<span class="c">#        #        &quot;nph1l&quot;: 1,</span>
<span class="c">#        #        &quot;qph1l&quot;: 1,</span>
<span class="c">#        #    })</span>
<span class="c">#        d.update(self.to_abivars())</span>
<span class="c">#</span>
<span class="c">#        from .wrappers import Anaddb</span>
<span class="c">#        anaddb = Anaddb(executable=executable, verbose=verbose)</span>
<span class="c">#        #anaddb.set_input(d)</span>
<span class="c">#        #phband, phdos, events = anaddb.fourier_interpolation()</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">pymatgen 2.9.10 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2011, Shyue Ping Ong, Anubhav Jain, Geoffroy Hautier, William Davidson Richard, Stephen Dacek, Sai Jayaraman, Michael Kocher, Dan Gunter, Shreyas Cholia, Vincent L Chevrier, Rickard Armiento.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>