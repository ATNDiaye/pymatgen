
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pymatgen.io.vaspio &mdash; pymatgen 1.7.2 documentation</title>
    
    <link rel="stylesheet" href="../../../static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../static/favicon.ico"/>
    <link rel="top" title="pymatgen 1.7.2 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">pymatgen 1.7.2 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pymatgen.io.vaspio</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes for reading/manipulating/writing VASP files.</span>
<span class="sd">All major VASP input files, plus the more common Vasp output files are available.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Shyue Ping Ong, Rickard Armiento, Vincent L Chevrier&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;Copyright 2011, The Materials Project&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;1.1&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s">&quot;Shyue Ping Ong&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;shyue@mit.edu&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s">&quot;Production&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s">&quot;Sep 23, 2011&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">xml.sax.handler</span>
<span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">det</span>

<span class="kn">import</span> <span class="nn">pymatgen.command_line.aconvasp_caller</span> <span class="kn">as</span> <span class="nn">aconvasp_caller</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.design_patterns</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.io_abc</span> <span class="kn">import</span> <span class="n">VaspInput</span>
<span class="kn">from</span> <span class="nn">pymatgen.util.string_utils</span> <span class="kn">import</span> <span class="n">str_aligned</span><span class="p">,</span> <span class="n">str_delimited</span>
<span class="kn">from</span> <span class="nn">pymatgen.util.io_utils</span> <span class="kn">import</span> <span class="n">file_open_zip_aware</span><span class="p">,</span> <span class="n">clean_lines</span><span class="p">,</span> <span class="n">micro_pyawk</span><span class="p">,</span> <span class="n">clean_json</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Composition</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.electronic_structure</span> <span class="kn">import</span> <span class="n">CompleteDos</span><span class="p">,</span> <span class="n">Dos</span><span class="p">,</span> <span class="n">PDos</span><span class="p">,</span> <span class="n">Spin</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">,</span> <span class="n">Bandstructure</span><span class="p">,</span> <span class="n">get_reconstructed_band_structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.lattice</span> <span class="kn">import</span> <span class="n">Lattice</span>
<span class="kn">import</span> <span class="nn">pymatgen</span>

<span class="n">coord_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;^\s*([\d+\.\-Ee]+)\s+([\d+\.\-Ee]+)\s+([\d+\.\-Ee]+)&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Poscar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar">[docs]</a><span class="k">class</span> <span class="nc">Poscar</span><span class="p">(</span><span class="n">VaspInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for representing the data in a POSCAR or CONTCAR file.</span>
<span class="sd">    Please note that this current implementation does not parse selective</span>
<span class="sd">    dynamcics POSCAR files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">selective_dynamics</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">true_names</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            struct:</span>
<span class="sd">                Structure object. See pymatgen.core.structure.Structure.</span>
<span class="sd">            comment:</span>
<span class="sd">                Optional comment line for POSCAR. Defaults to unit cell formula of structure. Defaults to None.</span>
<span class="sd">            selective_dynamics:</span>
<span class="sd">                Nx3 2D array of boolean values for selective dynamics, where N is number of sites. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">struct</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_struct</span> <span class="o">=</span> <span class="n">struct</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_site_symbols</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">syms</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">syms</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_site_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_true_names</span> <span class="o">=</span> <span class="n">true_names</span>
            <span class="k">if</span> <span class="n">selective_dynamics</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_selective_dynamics</span><span class="p">(</span><span class="n">selective_dynamics</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selective_dynamics</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">formula</span> <span class="k">if</span> <span class="n">comment</span> <span class="o">==</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">comment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Structure with partial occupancies cannot be converted into POSCAR!&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Poscar.set_selective_dynamics"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.set_selective_dynamics">[docs]</a>    <span class="k">def</span> <span class="nf">set_selective_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selective_dynamics</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">selective_dynamics</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">selective_dynamics</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Selective dynamics array must be same length as the structure.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selective_dynamics</span> <span class="o">=</span> <span class="n">selective_dynamics</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Poscar.selective_dynamics"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.selective_dynamics">[docs]</a>    <span class="k">def</span> <span class="nf">selective_dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selective_dynamics</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Poscar.site_symbols"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.site_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">site_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Symbols for each site in POSCAR.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_symbols</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Poscar.struct"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.struct">[docs]</a>    <span class="k">def</span> <span class="nf">struct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Structure associated with the Poscar file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Poscar.from_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.from_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a Poscar from a file.</span>
<span class="sd">        The code will try its best to determine the elements in the POSCAR in the following order:</span>
<span class="sd">        1. Ideally, if the input file is Vasp5-like and contains element symbols in the 6th line, the code will use that.</span>
<span class="sd">        2. Failing (1), the code will check if a symbol is provided at the end of each coordinate.</span>
<span class="sd">        3. Failing (i) and (ii), the code will try to check if a POTCAR is in the same directory as the POSCAR and use elements from that.</span>
<span class="sd">        If all else fails, the code will just assign the first n elements in increasing atomic number, where n is the number of species, </span>
<span class="sd">        to the Poscar.  For example, H, He, Li, ....  This will ensure at least a unique element is assigned to each site and any analysis </span>
<span class="sd">        that does not require specific elemental properties should work fine.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            filename - file name containing Poscar data.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Poscar object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s">&quot;POTCAR&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">potcar</span> <span class="o">=</span> <span class="n">Potcar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">potcar</span><span class="o">.</span><span class="n">symbols</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Poscar</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">names</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Poscar.from_string"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.from_string">[docs]</a>    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">default_names</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a Poscar from a string.</span>
<span class="sd">        The code will try its best to determine the elements in the POSCAR in the following order:</span>
<span class="sd">        1) Ideally, if the input file is Vasp5-like and contains element symbols in the 6th line, the code will use that.</span>
<span class="sd">        2) Failing (i), the code will check if a symbol is provided at the end of each coordinate.</span>
<span class="sd">        If all else fails, the code will just assign the first n elements in increasing atomic number, where n is the number of species, </span>
<span class="sd">        to the Poscar.  For example, H, He, Li, ....  This will ensure at least a unique element is assigned to each site and any analysis </span>
<span class="sd">        that does not require specific elemental properties should work fine.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            data:</span>
<span class="sd">                string containing Poscar data.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            Poscar object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">clean_lines</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span> <span class="bp">False</span><span class="p">))</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">lattice</span><span class="p">))</span>
            <span class="n">lattice</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">scale</span> <span class="o">/</span> <span class="n">vol</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">lattice</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lattice</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">lattice</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>

        <span class="n">vasp5_symbols</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">ipos</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">vasp5_symbols</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">atomic_symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">natoms</span><span class="p">)):</span>
                <span class="n">atomic_symbols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">natoms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ipos</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="n">postype</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">sdynamics</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># Selective dynamics</span>
        <span class="k">if</span> <span class="n">postype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;sS&#39;</span><span class="p">:</span>
            <span class="n">sdynamics</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">ipos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">postype</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">cart</span> <span class="o">=</span> <span class="n">postype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;cCkK&#39;</span>
        <span class="n">nsites</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">natoms</span><span class="p">)</span>

        <span class="c">#If default_names is specified (usually coming from a POTCAR), use them.</span>
        <span class="c">#This is in line with Vasp&#39;s parsing order that the POTCAR specified is the default used.</span>
        <span class="k">if</span> <span class="n">default_names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">atomic_symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">natoms</span><span class="p">)):</span>
                    <span class="n">atomic_symbols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">default_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">natoms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">vasp5_symbols</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vasp5_symbols</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">sdynamics</span> <span class="k">else</span> <span class="mi">6</span>
            <span class="k">try</span><span class="p">:</span> <span class="c">#check if names are appended at the end of the POSCAR coordinates</span>
                <span class="n">atomic_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">ind</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nsites</span><span class="p">]]</span>
                <span class="p">[</span><span class="n">Element</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">atomic_symbols</span><span class="p">]</span> <span class="c">#Ensure symbols are valid elements</span>
                <span class="n">vasp5_symbols</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c">#Defaulting to false names.</span>
                <span class="n">atomic_symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">natoms</span><span class="p">)):</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_Z</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">symbol</span>
                    <span class="n">atomic_symbols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">sym</span><span class="p">]</span> <span class="o">*</span> <span class="n">natoms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Elements in POSCAR cannot be determined. Defaulting to false names, &quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomic_symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>

        <span class="c"># read the atomic coordinates</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">selective_dynamics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> <span class="k">if</span> <span class="n">sdynamics</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nsites</span><span class="p">):</span>
            <span class="n">toks</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[:</span><span class="mi">3</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">sdynamics</span><span class="p">:</span>
                <span class="n">selective_dynamics</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">True</span> <span class="k">if</span> <span class="n">tok</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span> <span class="k">else</span> <span class="bp">False</span> <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]])</span>

        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">atomic_symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">cart</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">selective_dynamics</span><span class="p">,</span> <span class="n">vasp5_symbols</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Poscar.true_names"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.true_names">[docs]</a>    <span class="k">def</span> <span class="nf">true_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_true_names</span>
</div>
<div class="viewcode-block" id="Poscar.get_string"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.get_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direct</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">vasp4_compatible</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string to be written as a POSCAR file. By default, site symbols are written</span>
<span class="sd">        which means compatibilty is for vasp &gt;= 5.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            direct:</span>
<span class="sd">                Whether coordinates are output in direct or cartesian. Defaults to True.</span>
<span class="sd">            vasp4_compatible:</span>
<span class="sd">                Set to True to omit site symbols on 6th line to maintain backward vasp 4.x compatibility. Defaults to False.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            String representation of POSCAR.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct</span><span class="o">.</span><span class="n">lattice</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_true_names</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vasp4_compatible</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_site_symbols</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selective_dynamics</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Selective dynamics&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;direct&#39;</span> <span class="k">if</span> <span class="n">direct</span> <span class="k">else</span> <span class="s">&#39;cartesian&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct</span><span class="p">)):</span>
            <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">frac_coords</span> <span class="k">if</span> <span class="n">direct</span> <span class="k">else</span> <span class="n">site</span><span class="o">.</span><span class="n">coords</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%.6f</span><span class="s"> </span><span class="si">%.6f</span><span class="s"> </span><span class="si">%.6f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selective_dynamics</span><span class="p">:</span>
                <span class="n">sd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;T&#39;</span> <span class="k">if</span> <span class="n">j</span> <span class="k">else</span> <span class="s">&#39;F&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selective_dynamics</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&quot; </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">site</span><span class="o">.</span><span class="n">species_string</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation of Poscar file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_string</span><span class="p">()</span>

<div class="viewcode-block" id="Poscar.set_site_symbols"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.set_site_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">set_site_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site_symbols</span> <span class="o">=</span> <span class="n">symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_true_names</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c">#update the Structure as well</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_struct</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_struct</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Poscar.write_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Poscar.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div></div>
<span class="sd">&quot;&quot;&quot;**Non-exhaustive** list of valid INCAR tags&quot;&quot;&quot;</span>
<span class="n">VALID_INCAR_TAGS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;NGX&quot;</span><span class="p">,</span> <span class="s">&quot;NGY&quot;</span><span class="p">,</span> <span class="s">&quot;NGZ&quot;</span><span class="p">,</span> <span class="s">&quot;NGXF&quot;</span><span class="p">,</span> <span class="s">&quot;NGYF&quot;</span><span class="p">,</span> <span class="s">&quot;NGZF&quot;</span><span class="p">,</span> <span class="s">&quot;NBANDS&quot;</span><span class="p">,</span> <span class="s">&quot;NBLK&quot;</span><span class="p">,</span> <span class="s">&quot;SYSTEM&quot;</span><span class="p">,</span> <span class="s">&quot;NWRITE&quot;</span><span class="p">,</span> <span class="s">&quot;ENCUT&quot;</span><span class="p">,</span> <span class="s">&quot;ENAUG&quot;</span><span class="p">,</span>
<span class="s">&quot;PREC&quot;</span><span class="p">,</span> <span class="s">&quot;ISPIN&quot;</span><span class="p">,</span> <span class="s">&quot;MAGMOM&quot;</span><span class="p">,</span> <span class="s">&quot;ISTART&quot;</span><span class="p">,</span> <span class="s">&quot;ICHARG&quot;</span><span class="p">,</span> <span class="s">&quot;INIWAV&quot;</span><span class="p">,</span> <span class="s">&quot;NELM&quot;</span><span class="p">,</span> <span class="s">&quot;NELMIN&quot;</span><span class="p">,</span> <span class="s">&quot;NELMDL&quot;</span><span class="p">,</span> <span class="s">&quot;EDIFF&quot;</span><span class="p">,</span> <span class="s">&quot;EDIFFG&quot;</span><span class="p">,</span> <span class="s">&quot;NSW&quot;</span><span class="p">,</span> <span class="s">&quot;NBLOCK&quot;</span><span class="p">,</span>
<span class="s">&quot;KBLOCK&quot;</span><span class="p">,</span> <span class="s">&quot;IBRION&quot;</span><span class="p">,</span> <span class="s">&quot;NFREE&quot;</span><span class="p">,</span> <span class="s">&quot;POTIM&quot;</span><span class="p">,</span> <span class="s">&quot;ISIF&quot;</span><span class="p">,</span> <span class="s">&quot;PSTRESS&quot;</span><span class="p">,</span> <span class="s">&quot;IWAVPR&quot;</span><span class="p">,</span> <span class="s">&quot;ISYM&quot;</span><span class="p">,</span> <span class="s">&quot;SYMPREC&quot;</span><span class="p">,</span> <span class="s">&quot;LCORR&quot;</span><span class="p">,</span> <span class="s">&quot;TEBEG&quot;</span><span class="p">,</span> <span class="s">&quot;TEEND&quot;</span><span class="p">,</span> <span class="s">&quot;SMASS&quot;</span><span class="p">,</span>
<span class="s">&quot;NPACO&quot;</span><span class="p">,</span> <span class="s">&quot;APACO&quot;</span><span class="p">,</span> <span class="s">&quot;POMASS&quot;</span><span class="p">,</span> <span class="s">&quot;ZVAL&quot;</span><span class="p">,</span> <span class="s">&quot;RWIGS&quot;</span><span class="p">,</span> <span class="s">&quot;LORBIT&quot;</span><span class="p">,</span> <span class="s">&quot;NELECT&quot;</span><span class="p">,</span> <span class="s">&quot;NUPDOWN&quot;</span><span class="p">,</span> <span class="s">&quot;EMIN&quot;</span><span class="p">,</span> <span class="s">&quot;EMAX&quot;</span><span class="p">,</span> <span class="s">&quot;NEDOS&quot;</span><span class="p">,</span> <span class="s">&quot;ISMEAR&quot;</span><span class="p">,</span> <span class="s">&quot;SIGMA&quot;</span><span class="p">,</span>
<span class="s">&quot;FERWE&quot;</span><span class="p">,</span> <span class="s">&quot;FERDO&quot;</span><span class="p">,</span> <span class="s">&quot;SMEARINGS&quot;</span><span class="p">,</span> <span class="s">&quot;LREAL&quot;</span><span class="p">,</span> <span class="s">&quot;ROPT&quot;</span><span class="p">,</span> <span class="s">&quot;GGA&quot;</span><span class="p">,</span> <span class="s">&quot;VOSKOWN&quot;</span><span class="p">,</span> <span class="s">&quot;LASPH&quot;</span><span class="p">,</span> <span class="s">&quot;ALGO&quot;</span><span class="p">,</span> <span class="s">&quot;IALGO&quot;</span><span class="p">,</span> <span class="s">&quot;LDIAG&quot;</span><span class="p">,</span> <span class="s">&quot;NSIM&quot;</span><span class="p">,</span> <span class="s">&quot;IMIX&quot;</span><span class="p">,</span> <span class="s">&quot;INIMIX&quot;</span><span class="p">,</span>
<span class="s">&quot;MAXMIX&quot;</span><span class="p">,</span> <span class="s">&quot;AMIX&quot;</span><span class="p">,</span> <span class="s">&quot;BMIX&quot;</span><span class="p">,</span> <span class="s">&quot;AMIX_MAG&quot;</span><span class="p">,</span> <span class="s">&quot;BMIX_MAG&quot;</span><span class="p">,</span> <span class="s">&quot;AMIN&quot;</span><span class="p">,</span> <span class="s">&quot;MIXPRE&quot;</span><span class="p">,</span> <span class="s">&quot;WC&quot;</span><span class="p">,</span> <span class="s">&quot;WEIMIN&quot;</span><span class="p">,</span> <span class="s">&quot;EBREAK&quot;</span><span class="p">,</span> <span class="s">&quot;DEPER&quot;</span><span class="p">,</span> <span class="s">&quot;TIME&quot;</span><span class="p">,</span> <span class="s">&quot;LWAVE&quot;</span><span class="p">,</span> <span class="s">&quot;LCHARG&quot;</span><span class="p">,</span>
<span class="s">&quot;LVTOT&quot;</span><span class="p">,</span> <span class="s">&quot;LELF&quot;</span><span class="p">,</span> <span class="s">&quot;NPAR&quot;</span><span class="p">,</span> <span class="s">&quot;LPLANE&quot;</span><span class="p">,</span> <span class="s">&quot;LASYNC&quot;</span><span class="p">,</span> <span class="s">&quot;LSCALAPACK&quot;</span><span class="p">,</span> <span class="s">&quot;LSCALU&quot;</span><span class="p">,</span> <span class="s">&quot;ISPIND&quot;</span><span class="p">,</span> <span class="s">&quot;HFSCREEN&quot;</span><span class="p">,</span> <span class="s">&quot;LHFCALC&quot;</span><span class="p">,</span> <span class="s">&quot;ENCUTFOCK&quot;</span><span class="p">,</span> <span class="s">&quot;NKRED&quot;</span><span class="p">,</span> <span class="s">&quot;LMAXMIX&quot;</span><span class="p">,</span>
<span class="s">&quot;PRECFOCK&quot;</span><span class="p">,</span> <span class="s">&quot;AEXX&quot;</span><span class="p">,</span> <span class="s">&quot;AGGAX&quot;</span><span class="p">,</span> <span class="s">&quot;AGGAC&quot;</span><span class="p">,</span> <span class="s">&quot;ALDAC&quot;</span><span class="p">,</span> <span class="s">&quot;LMAXFOCK&quot;</span><span class="p">,</span> <span class="s">&quot;LMAXFOCKAE&quot;</span><span class="p">,</span> <span class="s">&quot;LTHOMAS&quot;</span><span class="p">,</span> <span class="s">&quot;NKREDX&quot;</span><span class="p">,</span> <span class="s">&quot;NKREDY&quot;</span><span class="p">,</span> <span class="s">&quot;NKREDZ&quot;</span><span class="p">,</span> <span class="s">&quot;EVENONLY&quot;</span><span class="p">,</span> <span class="s">&quot;ODDONLY&quot;</span><span class="p">,</span> <span class="s">&quot;LDAU&quot;</span><span class="p">,</span> <span class="s">&quot;LDAUJ&quot;</span><span class="p">,</span> <span class="s">&quot;LDAUL&quot;</span><span class="p">,</span> <span class="s">&quot;LDAUPRINT&quot;</span><span class="p">,</span> <span class="s">&quot;LDAUTYPE&quot;</span><span class="p">,</span> <span class="s">&quot;LDAUU&quot;</span><span class="p">,</span> <span class="s">&quot;LPEAD&quot;</span><span class="p">,</span> <span class="s">&quot;LCALCPOL&quot;</span><span class="p">,</span> <span class="s">&quot;LCALCEPS&quot;</span><span class="p">,</span> <span class="s">&quot;LEFG&quot;</span><span class="p">,</span> <span class="s">&quot;EFIELD_PEAD&quot;</span><span class="p">,</span> <span class="s">&quot;LNONCOLLINEAR&quot;</span><span class="p">,</span>
<span class="s">&quot;LSORBIT&quot;</span><span class="p">,</span> <span class="s">&quot;IDIPOL&quot;</span><span class="p">,</span> <span class="s">&quot;DIPOL&quot;</span><span class="p">,</span> <span class="s">&quot;LMONO&quot;</span><span class="p">,</span> <span class="s">&quot;LDIPOL&quot;</span><span class="p">,</span> <span class="s">&quot;EPSILON&quot;</span><span class="p">,</span> <span class="s">&quot;EFIELD&quot;</span><span class="p">,</span> <span class="s">&quot;LBERRY&quot;</span><span class="p">,</span> <span class="s">&quot;IGPAR&quot;</span><span class="p">,</span> <span class="s">&quot;NPPSTR&quot;</span><span class="p">,</span> <span class="s">&quot;IPEAD&quot;</span><span class="p">,</span> <span class="s">&quot;I_CONSTRAINED_M&quot;</span><span class="p">,</span> <span class="s">&quot;LAMBDA&quot;</span><span class="p">,</span> <span class="s">&quot;M_CONSTR&quot;</span><span class="p">,</span>
<span class="s">&quot;IMAGES&quot;</span><span class="p">,</span> <span class="s">&quot;SPRING&quot;</span><span class="p">,</span> <span class="s">&quot;LOPTICS&quot;</span><span class="p">,</span> <span class="s">&quot;CSHIFT&quot;</span><span class="p">,</span> <span class="s">&quot;LNABLA&quot;</span><span class="p">,</span> <span class="s">&quot;LEPSILON&quot;</span><span class="p">,</span> <span class="s">&quot;LRPA&quot;</span><span class="p">,</span> <span class="s">&quot;NOMEGA&quot;</span><span class="p">,</span> <span class="s">&quot;NOMEGAR&quot;</span><span class="p">,</span> <span class="s">&quot;LSPECTRAL&quot;</span><span class="p">,</span> <span class="s">&quot;OMEGAMAX&quot;</span><span class="p">,</span> <span class="s">&quot;OMEGATL&quot;</span><span class="p">,</span> <span class="s">&quot;ENCUTGW&quot;</span><span class="p">,</span>
<span class="s">&quot;ENCUTGWSOFT&quot;</span><span class="p">,</span> <span class="s">&quot;ODDONLYGW&quot;</span><span class="p">,</span> <span class="s">&quot;EVENONLYGW&quot;</span><span class="p">,</span> <span class="s">&quot;LSELFENERGY&quot;</span><span class="p">,</span> <span class="s">&#39;LRHFATM&#39;</span><span class="p">,</span> <span class="s">&#39;METAGGA&#39;</span><span class="p">,</span> <span class="s">&#39;LMAXTAU&#39;</span><span class="p">,</span> <span class="s">&#39;LCOMPAT&#39;</span><span class="p">,</span> <span class="s">&#39;ENMAX&#39;</span><span class="p">,</span> <span class="s">&#39;LMAXPAW&#39;</span><span class="p">,</span> <span class="s">&#39;LSPIRAL&#39;</span><span class="p">,</span> <span class="s">&#39;LZEROZ&#39;</span><span class="p">,</span>
<span class="s">&#39;LMETAGGA&#39;</span><span class="p">,</span> <span class="s">&#39;ENINI&#39;</span><span class="p">,</span> <span class="s">&#39;NRMM&#39;</span><span class="p">,</span> <span class="s">&#39;MREMOVE&#39;</span><span class="p">,</span> <span class="s">&#39;ADDGRID&#39;</span><span class="p">,</span> <span class="s">&#39;EFERMI&#39;</span><span class="p">,</span> <span class="s">&#39;LPARD&#39;</span><span class="p">,</span> <span class="s">&#39;LSCAAWARE&#39;</span><span class="p">,</span> <span class="s">&#39;IDIOT&#39;</span><span class="p">,</span> <span class="s">&#39;LMUSIC&#39;</span><span class="p">,</span> <span class="s">&#39;LREAL_COMPAT&#39;</span><span class="p">,</span> <span class="s">&#39;GGA_COMPAT&#39;</span><span class="p">,</span> <span class="s">&#39;ICORELEVEL&#39;</span><span class="p">,</span> <span class="s">&#39;LHFONE&#39;</span><span class="p">,</span>
<span class="s">&#39;LRHFCALC&#39;</span><span class="p">,</span> <span class="s">&#39;LMODELHF&#39;</span><span class="p">,</span> <span class="s">&#39;ENCUT4O&#39;</span><span class="p">,</span> <span class="s">&#39;EXXOEP&#39;</span><span class="p">,</span> <span class="s">&#39;FOURORBIT&#39;</span><span class="p">,</span> <span class="s">&#39;HFALPHA&#39;</span><span class="p">,</span> <span class="s">&#39;ALDAX&#39;</span><span class="p">,</span> <span class="s">&#39;SHIFTRED&#39;</span><span class="p">,</span> <span class="s">&#39;NMAXFOCKAE&#39;</span><span class="p">,</span> <span class="s">&#39;HFSCREENC&#39;</span><span class="p">,</span> <span class="s">&#39;MODEL_GW&#39;</span><span class="p">,</span> <span class="s">&#39;MODEL_EPS0&#39;</span><span class="p">,</span> <span class="s">&#39;MODEL_ALPHA&#39;</span><span class="p">,</span>
<span class="s">&#39;LVEL&#39;</span><span class="p">,</span> <span class="s">&#39;SAXIS&#39;</span><span class="p">,</span> <span class="s">&#39;QSPIRAL&#39;</span><span class="p">,</span> <span class="s">&#39;STM&#39;</span><span class="p">,</span> <span class="s">&#39;KINTER&#39;</span><span class="p">,</span> <span class="s">&#39;ORBITALMAG&#39;</span><span class="p">,</span> <span class="s">&#39;LMAGBLOCH&#39;</span><span class="p">,</span> <span class="s">&#39;LCHIMAG&#39;</span><span class="p">,</span> <span class="s">&#39;LGAUGE&#39;</span><span class="p">,</span> <span class="s">&#39;MAGATOM&#39;</span><span class="p">,</span> <span class="s">&#39;MAGDIPOL&#39;</span><span class="p">,</span> <span class="s">&#39;AVECCONST&#39;</span><span class="p">,</span> <span class="s">&#39;LTCTE&#39;</span><span class="p">,</span> <span class="s">&#39;LTETE&#39;</span><span class="p">,</span>
<span class="s">&#39;L2ORDER&#39;</span><span class="p">,</span> <span class="s">&#39;LGWLF&#39;</span><span class="p">,</span> <span class="s">&#39;ENCUTLF&#39;</span><span class="p">,</span> <span class="s">&#39;LMAXMP2&#39;</span><span class="p">,</span> <span class="s">&#39;SCISSOR&#39;</span><span class="p">,</span> <span class="s">&#39;NBANDSGW&#39;</span><span class="p">,</span> <span class="s">&#39;NBANDSLF&#39;</span><span class="p">,</span> <span class="s">&#39;DIM&#39;</span><span class="p">,</span> <span class="s">&#39;ANTIRES&#39;</span><span class="p">,</span> <span class="s">&#39;LUSEW&#39;</span><span class="p">,</span> <span class="s">&#39;OMEGAGRID&#39;</span><span class="p">,</span> <span class="s">&#39;SELFENERGY&#39;</span><span class="p">,</span> <span class="s">&#39;NKREDLFX&#39;</span><span class="p">,</span> <span class="s">&#39;NKREDLFY&#39;</span><span class="p">,</span>
<span class="s">&#39;NKREDLFZ&#39;</span><span class="p">,</span> <span class="s">&#39;MAXMEM&#39;</span><span class="p">,</span> <span class="s">&#39;TELESCOPE&#39;</span><span class="p">,</span> <span class="s">&#39;LCRITICAL_MEM&#39;</span><span class="p">,</span> <span class="s">&#39;GGA2&#39;</span><span class="p">,</span>
<span class="s">&#39;TURBO&#39;</span><span class="p">,</span> <span class="s">&#39;QUAD_EFG&#39;</span><span class="p">,</span> <span class="s">&#39;IRESTART&#39;</span><span class="p">,</span> <span class="s">&#39;NREBOOT&#39;</span><span class="p">,</span> <span class="s">&#39;NMIN&#39;</span><span class="p">,</span> <span class="s">&#39;EREF&#39;</span><span class="p">,</span> <span class="s">&#39;KSPACING&#39;</span><span class="p">,</span> <span class="s">&#39;KGAMMA&#39;</span><span class="p">,</span> <span class="s">&#39;LSUBROT&#39;</span><span class="p">,</span> <span class="s">&#39;SCALEE&#39;</span><span class="p">,</span> <span class="s">&#39;LVHAR&#39;</span><span class="p">,</span> <span class="s">&#39;LORBITALREAL&#39;</span><span class="p">,</span> <span class="s">&#39;DARWINR&#39;</span><span class="p">,</span> <span class="s">&#39;DARWINV&#39;</span><span class="p">,</span> <span class="s">&#39;LFOCKAEDFT&#39;</span><span class="p">,</span> <span class="s">&#39;NUCIND&#39;</span><span class="p">,</span> <span class="s">&#39;MAGPOS&#39;</span><span class="p">,</span> <span class="s">&#39;LNICSALL&#39;</span><span class="p">,</span> <span class="s">&#39;LADDER&#39;</span><span class="p">,</span> <span class="s">&#39;LHARTREE&#39;</span><span class="p">,</span> <span class="s">&#39;IBSE&#39;</span><span class="p">,</span> <span class="s">&#39;NBANDSO&#39;</span><span class="p">,</span> <span class="s">&#39;NBANDSV&#39;</span><span class="p">,</span> <span class="s">&#39;OPTEMAX&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Incar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar">[docs]</a><span class="k">class</span> <span class="nc">Incar</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">VaspInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INCAR object for reading and writing INCAR files</span>
<span class="sd">    essentially consists of a dictionary with some helper functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an Incar object.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            params - A set of input parameters as a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Incar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add parameter-val pair to Incar.  Warns if parameter is not in list of valid INCAR tags.</span>
<span class="sd">        Also cleans the parameter and val by stripping leading and trailing white spaces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_INCAR_TAGS</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; not in VALID_INCAR_TAGS&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Incar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">Incar</span><span class="o">.</span><span class="n">proc_val</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Incar.to_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Incar.from_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">i</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">i</span>
</div>
<div class="viewcode-block" id="Incar.get_string"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.get_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort_keys</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">pretty</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string representation of the INCAR.  The reason why this method is</span>
<span class="sd">        different from the __str__ method is to provide options for pretty printing.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            sort_keys:</span>
<span class="sd">                Set to True to sort the INCAR parameters alphabetically. Defaults to False.</span>
<span class="sd">            pretty:</span>
<span class="sd">                Set to True for pretty aligned output. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sort_keys</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&quot;MAGMOM&quot;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;{}*{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">g</span><span class="p">)),</span> <span class="n">m</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]])])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>

        <span class="k">if</span> <span class="n">pretty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">str_aligned</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">str_delimited</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot; = &quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">sort_keys</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pretty</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<div class="viewcode-block" id="Incar.write_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write Incar to a file.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            filename:</span>
<span class="sd">                filename to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Incar.from_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.from_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads an Incar object from a file.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            filename - Filename for file</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Incar object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">clean_lines</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;(\w+)\s*=\s*(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">Incar</span><span class="o">.</span><span class="n">proc_val</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Incar.proc_val"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.proc_val">[docs]</a>    <span class="k">def</span> <span class="nf">proc_val</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Static helper method to convert INCAR parameters to proper types, e.g. integers, floats, lists, etc.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            key:</span>
<span class="sd">                INCAR parameter key</span>
<span class="sd">            val:</span>
<span class="sd">                Actual value of INCAR parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_type_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;LDAUU&#39;</span><span class="p">,</span> <span class="s">&#39;LDAUL&#39;</span><span class="p">,</span> <span class="s">&#39;LDAUJ&#39;</span><span class="p">,</span> <span class="s">&#39;LDAUTYPE&#39;</span><span class="p">,</span> <span class="s">&#39;MAGMOM&#39;</span><span class="p">)</span>
        <span class="n">boolean_type_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;LDAU&#39;</span><span class="p">,</span> <span class="s">&#39;LWAVE&#39;</span><span class="p">,</span> <span class="s">&#39;LSCALU&#39;</span><span class="p">,</span> <span class="s">&#39;LCHARG&#39;</span><span class="p">,</span> <span class="s">&#39;LPLANE&#39;</span><span class="p">,</span> <span class="s">&#39;LHFCALC&#39;</span><span class="p">)</span>
        <span class="n">float_type_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;EDIFF&quot;</span><span class="p">,</span> <span class="s">&quot;SIGMA&quot;</span><span class="p">,</span> <span class="s">&#39;TIME&#39;</span><span class="p">,</span> <span class="s">&#39;ENCUTFOCK&#39;</span><span class="p">,</span> <span class="s">&#39;HFSCREEN&#39;</span><span class="p">)</span>
        <span class="n">int_type_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;NSW&#39;</span><span class="p">,</span> <span class="s">&#39;NELMIN&#39;</span><span class="p">,</span> <span class="s">&#39;ISIF&#39;</span><span class="p">,</span> <span class="s">&#39;IBRION&#39;</span><span class="p">,</span> <span class="s">&quot;ISPIN&quot;</span><span class="p">,</span> <span class="s">&quot;ICHARG&quot;</span><span class="p">,</span> <span class="s">&quot;NELM&quot;</span><span class="p">,</span>
                         <span class="s">&quot;ISMEAR&quot;</span><span class="p">,</span> <span class="s">&quot;NPAR&quot;</span><span class="p">,</span> <span class="s">&quot;LDAUPRINT&quot;</span><span class="p">,</span> <span class="s">&#39;LMAXMIX&#39;</span><span class="p">,</span> <span class="s">&#39;ENCUT&#39;</span><span class="p">,</span> <span class="s">&#39;NSIM&#39;</span><span class="p">,</span>
                         <span class="s">&#39;NKRED&#39;</span><span class="p">,</span> <span class="s">&#39;NUPDOWN&#39;</span><span class="p">,</span> <span class="s">&#39;ISPIND&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">smart_int_or_float</span><span class="p">(</span><span class="n">numstr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">numstr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">list_type_keys</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">toks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;(\d+)\*([\d\.\-\+]+)&quot;</span><span class="p">,</span> <span class="n">tok</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">smart_int_or_float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smart_int_or_float</span><span class="p">(</span><span class="n">tok</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">output</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">boolean_type_keys</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;^\W+([TtFf])&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;T&quot;</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;t&quot;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">False</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s">&quot; should be a boolean type!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">float_type_keys</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">int_type_keys</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Incar.diff"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Incar.diff">[docs]</a>    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Diff function for Incar.  Compares two Incars and indicates which parameters are the same and which are not.</span>
<span class="sd">        Useful for checking whether two runs were done using the same parameters.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            other : The other Incar object to compare to.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Dict of the following format - {&#39;Same&#39; : parameters_that_are_the_same, &#39;Different&#39;: parameters_that_are_different}</span>
<span class="sd">            Note that the parameters are return as full dictionaries of values. E.g. {&#39;ISIF&#39;:3}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">similar_param</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">different_param</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                <span class="n">different_param</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;INCAR1&quot;</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="s">&quot;INCAR2&quot;</span><span class="p">:</span> <span class="s">&#39;Default&#39;</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]:</span>
                <span class="n">different_param</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;INCAR1&quot;</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="s">&quot;INCAR2&quot;</span><span class="p">:</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">similar_param</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">similar_param</span> <span class="ow">and</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">different_param</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">different_param</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;INCAR1&quot;</span><span class="p">:</span> <span class="s">&#39;Default&#39;</span><span class="p">,</span> <span class="s">&quot;INCAR2&quot;</span><span class="p">:</span> <span class="n">v2</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;Same&#39;</span> <span class="p">:</span> <span class="n">similar_param</span><span class="p">,</span> <span class="s">&#39;Different&#39;</span><span class="p">:</span> <span class="n">different_param</span><span class="p">}</span>
</div>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add all the values of another INCAR object to this object</span>
<span class="sd">        Facilitates the use of &quot;standard&quot; INCARs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Incars have conflicting values!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">Incar</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Kpoints"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints">[docs]</a><span class="k">class</span> <span class="nc">Kpoints</span><span class="p">(</span><span class="n">VaspInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KPOINT reader/writer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">supported_modes</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">((</span><span class="s">&quot;Gamma&quot;</span><span class="p">,</span> <span class="s">&quot;Monkhorst&quot;</span><span class="p">,</span> <span class="s">&quot;Automatic&quot;</span><span class="p">,</span> <span class="s">&quot;Line_mode&quot;</span><span class="p">,</span> <span class="s">&quot;Cartesian&quot;</span><span class="p">,</span> <span class="s">&quot;Reciprocal&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;Default gamma&quot;</span><span class="p">,</span> <span class="n">num_kpts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">supported_modes</span><span class="o">.</span><span class="n">Gamma</span><span class="p">,</span>
                 <span class="n">kpts</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">kpts_shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                 <span class="n">kpts_weights</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">coord_type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">tet_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tet_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tet_connections</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Highly flexible constructor for Kpoints object.  The flexibility comes at the cost of usability and in </span>
<span class="sd">        general, it is recommended that you use the default constructor only if you know exactly what you are doing</span>
<span class="sd">        and requires the flexibility.  For most usage cases, the three automatic schemes can be constructed far </span>
<span class="sd">        more easily using the convenience static constructors (automatic, gamma_automatic, monkhorst_automatic) and it </span>
<span class="sd">        is recommended that you use those.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            comment:</span>
<span class="sd">                String comment for Kpoints</span>
<span class="sd">            num_kpts:</span>
<span class="sd">                Following VASP method of defining the KPOINTS file, this parameter is the number of kpoints specified.</span>
<span class="sd">                If set to 0 (or negative), VASP automatically generates the KPOINTS.</span>
<span class="sd">            style:</span>
<span class="sd">                Style for generating KPOINTS.  Use one of the Kpoints.supported_modes enum types.</span>
<span class="sd">            kpts:</span>
<span class="sd">                2D array of kpoints.  Even when only a single specification is required, e.g. in the automatic scheme, </span>
<span class="sd">                the kpts should still be specified as a 2D array. e.g., [[20]] or [[2,2,2]].</span>
<span class="sd">            kpts_shift:</span>
<span class="sd">                Shift for Kpoints.</span>
<span class="sd">            kpts_weights:</span>
<span class="sd">                Optional weights for kpoints.  For explicit kpoints.</span>
<span class="sd">            coord_type:</span>
<span class="sd">                In line-mode, this variable specifies whether the Kpoints were given in Cartesian or Reciprocal coordinates</span>
<span class="sd">            labels:</span>
<span class="sd">                In line-mode, this should provide a list of labels for each kpts.</span>
<span class="sd">            tet_number:</span>
<span class="sd">                For explicit kpoints, specifies the number of tetrahedrons for the tetrahedron method.</span>
<span class="sd">            tet_weight:</span>
<span class="sd">                For explicit kpoints, specifies the weight for each tetrahedron for the tetrahedron method.</span>
<span class="sd">            tet_connections:</span>
<span class="sd">                For explicit kpoints, specifies the connections of the tetrahedrons for the tetrahedron method.</span>
<span class="sd">                Format is a list of tuples, [ (sym_weight, [tet_vertices]), ...]           </span>
<span class="sd">        </span>
<span class="sd">        The default behavior of the constructor is for a Gamma centered, 1x1x1 KPOINTS with no shift.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_kpts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">labels</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">kpts_weights</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;For explicit or line-mode kpoints, either the labels or kpts_weights must be specified.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Automatic</span><span class="p">,</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Gamma</span><span class="p">,</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Monkhorst</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;For fully automatic or automatic gamma or monk kpoints, only a single line for the number of divisions is allowed.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_kpts</span> <span class="o">=</span> <span class="n">num_kpts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_type</span> <span class="o">=</span> <span class="n">coord_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpts</span> <span class="o">=</span> <span class="n">kpts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpts_weights</span> <span class="o">=</span> <span class="n">kpts_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpts_shift</span> <span class="o">=</span> <span class="n">kpts_shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tet_number</span> <span class="o">=</span> <span class="n">tet_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tet_weight</span> <span class="o">=</span> <span class="n">tet_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tet_connections</span> <span class="o">=</span> <span class="n">tet_connections</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Kpoints.automatic"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.automatic">[docs]</a>    <span class="k">def</span> <span class="nf">automatic</span><span class="p">(</span><span class="n">subdivisions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenient static constructor for a fully automatic Kpoint grid, with </span>
<span class="sd">        gamma centered Monkhorst-Pack grids and the number of subdivisions along</span>
<span class="sd">        each reciprocal lattice vector determined by the scheme in the VASP manual.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            subdivisions:</span>
<span class="sd">                 Parameter determining number of subdivisions along each reciprocal lattice vector</span>
<span class="sd">                 </span>
<span class="sd">        Returns:</span>
<span class="sd">            Kpoints object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="s">&quot;Fully automatic kpoint scheme&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Automatic</span><span class="p">,</span> <span class="n">kpts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">subdivisions</span><span class="p">]])</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Kpoints.gamma_automatic"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.gamma_automatic">[docs]</a>    <span class="k">def</span> <span class="nf">gamma_automatic</span><span class="p">(</span><span class="n">kpts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenient static constructor for an automatic Gamma centered Kpoint grid.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            kpts:</span>
<span class="sd">                Subdivisions N_1, N_2 and N_3 along reciprocal lattice vectors. Defaults to (1,1,1)</span>
<span class="sd">            shift:</span>
<span class="sd">                Shift to be applied to the kpoints. Defaults to (0,0,0)</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            Kpoints object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="s">&quot;Automatic kpoint scheme&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Gamma</span><span class="p">,</span> <span class="n">kpts</span> <span class="o">=</span> <span class="p">[</span><span class="n">kpts</span><span class="p">],</span> <span class="n">kpts_shift</span> <span class="o">=</span> <span class="n">shift</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Kpoints.monkhorst_automatic"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.monkhorst_automatic">[docs]</a>    <span class="k">def</span> <span class="nf">monkhorst_automatic</span><span class="p">(</span><span class="n">kpts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenient static constructor for an automatic Monkhorst pack Kpoint grid.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            kpts:</span>
<span class="sd">                Subdivisions N_1, N_2 and N_3 along reciprocal lattice vectors. Defaults to (2,2,2)</span>
<span class="sd">            shift:</span>
<span class="sd">                Shift to be applied to the kpoints. Defaults to (0,0,0)</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            Kpoints object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="s">&quot;Automatic kpoint scheme&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Monkhorst</span><span class="p">,</span> <span class="n">kpts</span> <span class="o">=</span> <span class="p">[</span><span class="n">kpts</span><span class="p">],</span> <span class="n">kpts_shift</span> <span class="o">=</span> <span class="n">shift</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Kpoints.monkhorst_automatic_density"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.monkhorst_automatic_density">[docs]</a>    <span class="k">def</span> <span class="nf">monkhorst_automatic_density</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">kppa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The approach we took here is to use aconvasp to get the kpoint divisions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">div</span> <span class="o">=</span> <span class="n">aconvasp_caller</span><span class="o">.</span><span class="n">get_num_division_kpoints</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">kppa</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c">#FIXME This makes little sense to ask for monkhorst_automatic and it&#39; returns gamma centered mesh</span>

        <span class="c">#check if hexagonal!!!!</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">_is_hexagonal</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">gamma_automatic</span><span class="p">(</span><span class="n">div</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">monkhorst_automatic</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_hexagonal</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
        <span class="c"># Why is this method here?</span>
        <span class="n">proto1</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">]</span>
        <span class="n">proto2</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
        <span class="n">angCopy</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">angles</span><span class="p">]</span>
        <span class="n">angCopy</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">anglesCheck</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angCopy</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">angCopy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">proto1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">):</span>
                <span class="n">anglesCheck</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">angCopy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">proto2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">):</span>
                <span class="n">anglesCheck</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">num_equals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">):</span>
            <span class="n">num_equals</span> <span class="o">=</span> <span class="n">num_equals</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">):</span>
            <span class="n">num_equals</span> <span class="o">=</span> <span class="n">num_equals</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">):</span>
            <span class="n">num_equals</span> <span class="o">=</span> <span class="n">num_equals</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span><span class="p">(</span><span class="n">num_equals</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">anglesCheck</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Kpoints.from_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.from_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a Kpoints object from a KPOINTS file.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            filename:</span>
<span class="sd">                filename to read from.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            Kpoints object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">num_kpts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c">#Fully automatic KPOINTS</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;a&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">automatic</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="c">#Automatic gamma and Monk KPOINTS, with optional shift</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;g&quot;</span> <span class="ow">or</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">kpts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">kpts_shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">coord_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">kpts_shift</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">return</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">gamma_automatic</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="n">kpts_shift</span><span class="p">)</span> <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;g&quot;</span> <span class="k">else</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">monkhorst_automatic</span><span class="p">(</span><span class="n">kpts</span><span class="p">,</span> <span class="n">kpts_shift</span><span class="p">)</span>

        <span class="c">#Automatic kpoints with basis</span>
        <span class="k">if</span> <span class="n">num_kpts</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Cartesian</span> <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="s">&quot;ck&quot;</span> <span class="k">else</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span>
            <span class="n">kpts</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
            <span class="n">kpts_shift</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">num_kpts</span> <span class="o">=</span> <span class="n">num_kpts</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="p">,</span> <span class="n">kpts</span> <span class="o">=</span> <span class="n">kpts</span><span class="p">,</span> <span class="n">kpts_shift</span> <span class="o">=</span> <span class="n">kpts_shift</span><span class="p">)</span>

        <span class="c">#Line-mode KPOINTS, usually used with band structures</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&#39;l&#39;</span><span class="p">:</span>
            <span class="n">coord_type</span> <span class="o">=</span> <span class="s">&#39;Cartesian&#39;</span> <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;ck&#39;</span> <span class="k">else</span> <span class="s">&#39;Reciprocal&#39;</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Line_mode</span>
            <span class="n">kpts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">patt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;([0-9\.\-]+)\s+([0-9\.\-]+)\s+([0-9\.\-]+)\s*!\s*(.*)&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">patt</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">num_kpts</span> <span class="o">=</span> <span class="n">num_kpts</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="p">,</span>
                 <span class="n">kpts</span> <span class="o">=</span> <span class="n">kpts</span><span class="p">,</span> <span class="n">coord_type</span> <span class="o">=</span> <span class="n">coord_type</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">)</span>

        <span class="c">#Assume explicit KPOINTS if all else fails.</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Cartesian</span> <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;ck&quot;</span> <span class="k">else</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span>
        <span class="n">kpts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kpts_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tet_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tet_weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tet_connections</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">num_kpts</span><span class="p">):</span>
            <span class="n">toks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>
            <span class="n">kpts_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c">#Deal with tetrahedron method</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">num_kpts</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;t&#39;</span><span class="p">:</span>
                <span class="n">toks</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">num_kpts</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">tet_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">tet_weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">tet_connections</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="n">num_kpts</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">num_kpts</span> <span class="o">+</span> <span class="n">tet_number</span><span class="p">):</span>
                    <span class="n">toks</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">tet_connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">num_kpts</span> <span class="o">=</span> <span class="n">num_kpts</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="p">,</span>
                 <span class="n">kpts</span> <span class="o">=</span> <span class="n">kpts</span><span class="p">,</span> <span class="n">kpts_weights</span> <span class="o">=</span> <span class="n">kpts_weights</span><span class="p">,</span>
                 <span class="n">tet_number</span> <span class="o">=</span> <span class="n">tet_number</span><span class="p">,</span> <span class="n">tet_weight</span> <span class="o">=</span> <span class="n">tet_weight</span><span class="p">,</span> <span class="n">tet_connections</span> <span class="o">=</span> <span class="n">tet_connections</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Kpoints.write_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write Kpoints to a file.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            filename:</span>
<span class="sd">                filename to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_kpts</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;Line-mode&quot;</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_type</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kpts</span><span class="p">)):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpts</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
            <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s">&quot;l&quot;</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&quot; ! &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_kpts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&quot; </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kpts_weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c">#Print tetrahedorn parameters if the number of tetrahedrons &gt; 0</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">&quot;lagm&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tet_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Tetrahedron&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tet_number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tet_weight</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">sym_weight</span><span class="p">,</span> <span class="n">vertices</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tet_connections</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sym_weight</span><span class="p">,</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="c">#Print shifts for automatic kpoints types if not zero.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_kpts</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kpts_shift</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpts_shift</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Kpoints.to_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;json friendly dict representation of Kpoints&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;comment&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s">&#39;nkpoints&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_kpts</span><span class="p">,</span> <span class="s">&#39;generation_style&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="s">&#39;kpoints&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpts</span><span class="p">,</span> <span class="s">&#39;usershift&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpts_shift</span><span class="p">}</span>
        <span class="n">optional_paras</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;genvec1&#39;</span><span class="p">,</span> <span class="s">&#39;genvec2&#39;</span><span class="p">,</span> <span class="s">&#39;genvec3&#39;</span><span class="p">,</span> <span class="s">&#39;shift&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">optional_paras</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">para</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">para</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">para</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Kpoints.from_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Kpoints.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;comment&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">generation_style</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;generation_style&#39;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&quot;Kpoints.supported_modes.&quot;</span> <span class="o">+</span> <span class="n">generation_style</span>
        <span class="n">style</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">kpts</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;kpoints&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">kpts_shift</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;usershift&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">num_kpts</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nkpoints&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c">#coord_type = d.get(&#39;coord_type&#39;, None)</span>
        <span class="k">return</span> <span class="n">Kpoints</span><span class="p">(</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">kpts</span> <span class="o">=</span> <span class="n">kpts</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="p">,</span> <span class="n">kpts_shift</span> <span class="o">=</span> <span class="n">kpts_shift</span><span class="p">,</span> <span class="n">num_kpts</span> <span class="o">=</span> <span class="n">num_kpts</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="PotcarSingle"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.PotcarSingle">[docs]</a><span class="k">class</span> <span class="nc">PotcarSingle</span><span class="p">(</span><span class="n">VaspInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for a **single** POTCAR.</span>
<span class="sd">    The builder assumes the complete string is the POTCAR</span>
<span class="sd">    contains the complete untouched data in &quot;data&quot; as a string and</span>
<span class="sd">    a dictionary of keywords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expects a complete and single potcar file as a string in &quot;data&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="c"># raw POTCAR as a string</span>
        <span class="n">keyValPairs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;;*\s*(.+?)\s*=\s*([^;\n]+)\s*&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">keyValPairs</span><span class="p">)</span> <span class="c"># all key = val found in the POTCAR as a dictionary all keys and vals are strings</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

<div class="viewcode-block" id="PotcarSingle.write_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.PotcarSingle.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PotcarSingle.symbol"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.PotcarSingle.symbol">[docs]</a>    <span class="k">def</span> <span class="nf">symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Full name of POTCAR, e.g., Fe_pv</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s">&#39;TITEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PotcarSingle.element"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.PotcarSingle.element">[docs]</a>    <span class="k">def</span> <span class="nf">element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to return the atomic symbol based on the VRHFIN keyword</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s">&#39;VRHFIN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PotcarSingle.atomic_no"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.PotcarSingle.atomic_no">[docs]</a>    <span class="k">def</span> <span class="nf">atomic_no</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to return the atomic number based on the VRHFIN keyword</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span>
</div></div>
<div class="viewcode-block" id="Potcar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar">[docs]</a><span class="k">class</span> <span class="nc">Potcar</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">VaspInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for reading and writing POTCAR files for</span>
<span class="sd">    calculations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">functional_dir</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;PBE&#39;</span><span class="p">:</span><span class="s">&#39;POT_GGA_PAW_PBE&#39;</span><span class="p">,</span> <span class="s">&#39;LDA&#39;</span><span class="p">:</span><span class="s">&#39;POT_LDA_PAW&#39;</span><span class="p">,</span> <span class="s">&#39;PW91&#39;</span><span class="p">:</span><span class="s">&#39;POT_GGA_PAW_PW91&#39;</span><span class="p">}</span>
    <span class="n">DEFAULT_FUNCTIONAL</span> <span class="o">=</span> <span class="s">&quot;PBE&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">functional</span> <span class="o">=</span> <span class="n">DEFAULT_FUNCTIONAL</span><span class="p">,</span> <span class="n">sym_potcar_map</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">symbols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">functional</span> <span class="o">=</span> <span class="n">functional</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">functional</span><span class="p">,</span> <span class="n">sym_potcar_map</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Potcar.to_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;functional&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">functional</span><span class="p">,</span> <span class="s">&#39;symbols&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">}</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Potcar.from_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">functional</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;functional&#39;</span><span class="p">]</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;symbols&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Potcar</span><span class="p">(</span><span class="n">symbols</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">functional</span> <span class="o">=</span> <span class="n">functional</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Potcar.from_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar.from_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">fData</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">potcar</span> <span class="o">=</span> <span class="n">Potcar</span><span class="p">()</span>
        <span class="n">potcar_strings</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\n{0,1}\s*(.*?End of Dataset)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">fData</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">potcar_strings</span><span class="p">:</span>
            <span class="n">potcar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PotcarSingle</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">potcar</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">potcar</span><span class="p">)</span> <span class="k">for</span> <span class="n">potcar</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>    <span class="c">#line break not used because there is already one at the end of str(potcar) and it causes VASP issues</span>

<div class="viewcode-block" id="Potcar.write_file"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write Potcar to a file.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            filename:</span>
<span class="sd">                filename to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Potcar.symbols"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar.symbols">[docs]</a>    <span class="k">def</span> <span class="nf">symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the atomic symbols of all the atoms in the POTCAR file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Potcar.set_symbols"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Potcar.set_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">set_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">functional</span> <span class="o">=</span> <span class="n">DEFAULT_FUNCTIONAL</span><span class="p">,</span> <span class="n">sym_potcar_map</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize the POTCAR from a set of symbols. Currently, the POTCARs can be fetched from a location specified in pymatgen.cfg or specified explicitly in a map (but not both)</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            elements: a list of element symbols</span>
<span class="sd">            functional: (optional) the functional to use from the config file</span>
<span class="sd">            sym_potcar_map: (optional) a map of symbol:raw POTCAR string. If sym_potcar_map is specified, POTCARs will be generated from the given map data rather than the config file location.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sym_potcar_map</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PotcarSingle</span><span class="p">(</span><span class="n">sym_potcar_map</span><span class="p">[</span><span class="n">el</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">module_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">SafeConfigParser</span><span class="p">()</span>
            <span class="n">config</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">module_dir</span><span class="p">,</span> <span class="s">&quot;pymatgen.cfg&quot;</span><span class="p">)))</span>
            <span class="n">VASP_PSP_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;VASP&#39;</span><span class="p">,</span> <span class="s">&#39;pspdir&#39;</span><span class="p">),</span> <span class="n">Potcar</span><span class="o">.</span><span class="n">functional_dir</span><span class="p">[</span><span class="n">functional</span><span class="p">])</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[:]</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">VASP_PSP_DIR</span><span class="p">,</span> <span class="s">&quot;POTCAR.&quot;</span> <span class="o">+</span> <span class="n">el</span> <span class="o">+</span> <span class="s">&quot;.gz&quot;</span><span class="p">),</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PotcarSingle</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

</div></div>
<div class="viewcode-block" id="Vasprun"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun">[docs]</a><span class="k">class</span> <span class="nc">Vasprun</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vastly improved sax-based parser for vasprun.xml files.</span>
<span class="sd">    Speedup over Dom is at least 2x for smallish files (~1Mb) to orders of magnitude for larger files (~10Mb).</span>
<span class="sd">    All data is stored as attributes, which are delegated to the VasprunHandler object.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">    </span>
<span class="sd">        **Vasp results**</span>
<span class="sd">        </span>
<span class="sd">        ionic_steps: </span>
<span class="sd">            All ionic steps in the run as a list of {&#39;structure&#39;: structure at end of run, &#39;electronic_steps&#39; : {All electronic step data in vasprun file}, &#39;stresses&#39; : stress matrix}</span>
<span class="sd">        structures: </span>
<span class="sd">            List of Structure objects for the structure at each ionic step.</span>
<span class="sd">        tdos: </span>
<span class="sd">            Total dos calculated at the end of run.</span>
<span class="sd">        idos: </span>
<span class="sd">            Integrated dos calculated at the end of run.</span>
<span class="sd">        pdos: </span>
<span class="sd">            List of list of PDos objects. Access as pdos[atomindex][orbitalindex]</span>
<span class="sd">        efermi: </span>
<span class="sd">            Fermi energy</span>
<span class="sd">        eigenvalues: </span>
<span class="sd">            Final eigenvalues as a dict of {(kpoint index, Spin.up):[[eigenvalue, occu]]}. </span>
<span class="sd">            This representation is probably not ideal, but since this is not used anywhere else for now, I leave it as such.</span>
<span class="sd">            Future developers who need to work with this should refactored the object into a sensible structure.</span>
<span class="sd">        </span>
<span class="sd">        **Vasp inputs**</span>
<span class="sd">        </span>
<span class="sd">        incar:</span>
<span class="sd">            Incar object for parameters specified in INCAR file.</span>
<span class="sd">        parameters:</span>
<span class="sd">            Incar object with parameters that vasp actually used, including all defaults.</span>
<span class="sd">        kpoints:</span>
<span class="sd">            Kpoints object for KPOINTS specified in run.</span>
<span class="sd">        actual_kpoints:</span>
<span class="sd">            List of actual kpoints, e.g., [[0.25, 0.125, 0.08333333], [-0.25, 0.125, 0.08333333], [0.25, 0.375, 0.08333333], ....]</span>
<span class="sd">        actual_kpoints_weights:</span>
<span class="sd">            List of kpoint weights, E.g., [0.04166667, 0.04166667, 0.04166667, 0.04166667, 0.04166667, 0.04166667, ....]</span>
<span class="sd">        atomic_symbols:</span>
<span class="sd">            List of atomic symbols, e.g., [u&#39;Li&#39;, u&#39;Fe&#39;, u&#39;Fe&#39;, u&#39;P&#39;, u&#39;P&#39;, u&#39;P&#39;]</span>
<span class="sd">        potcar_symbols:</span>
<span class="sd">            List of POTCAR symbols. E.g., [u&#39;PAW_PBE Li 17Jan2003&#39;, u&#39;PAW_PBE Fe 06Sep2000&#39;, ..]</span>
<span class="sd">    </span>
<span class="sd">        **Convenience attributes**</span>
<span class="sd">        </span>
<span class="sd">        final_energy: </span>
<span class="sd">            Final energy from the run.</span>
<span class="sd">        final_structure: </span>
<span class="sd">            Final relaxed structure.</span>
<span class="sd">        initial_structure: </span>
<span class="sd">            Initial input structure.</span>
<span class="sd">        complete_dos: </span>
<span class="sd">            CompleteDos object containing both the total and projected Dos from the run.</span>
<span class="sd">    </span>
<span class="sd">    Author: Shyue Ping Ong</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">supported_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lattice_rec&#39;</span><span class="p">,</span> <span class="s">&#39;vasp_version&#39;</span><span class="p">,</span> <span class="s">&#39;incar&#39;</span><span class="p">,</span> <span class="s">&#39;parameters&#39;</span><span class="p">,</span> <span class="s">&#39;potcar_symbols&#39;</span><span class="p">,</span> <span class="s">&#39;atomic_symbols&#39;</span><span class="p">,</span> <span class="s">&#39;kpoints&#39;</span><span class="p">,</span> <span class="s">&#39;actual_kpoints&#39;</span><span class="p">,</span> <span class="s">&#39;structures&#39;</span><span class="p">,</span>
                            <span class="s">&#39;actual_kpoints_weights&#39;</span><span class="p">,</span> <span class="s">&#39;dos_energies&#39;</span><span class="p">,</span> <span class="s">&#39;eigenvalues&#39;</span><span class="p">,</span> <span class="s">&#39;tdos&#39;</span><span class="p">,</span> <span class="s">&#39;idos&#39;</span><span class="p">,</span> <span class="s">&#39;pdos&#39;</span><span class="p">,</span> <span class="s">&#39;efermi&#39;</span><span class="p">,</span> <span class="s">&#39;ionic_steps&#39;</span><span class="p">,</span> <span class="s">&#39;dos_has_errors&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="n">VasprunHandler</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Vasprun</span><span class="o">.</span><span class="n">supported_properties</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.converged"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.converged">[docs]</a>    <span class="k">def</span> <span class="nf">converged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if a relaxation run is converged.  Always True for a static run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;NSW&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;NSW&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.final_energy"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.final_energy">[docs]</a>    <span class="k">def</span> <span class="nf">final_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Final energy from the vasp run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;electronic_steps&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;e_wo_entrp&#39;</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.final_structure"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.final_structure">[docs]</a>    <span class="k">def</span> <span class="nf">final_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Final structure from vasprun.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.initial_structure"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.initial_structure">[docs]</a>    <span class="k">def</span> <span class="nf">initial_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initial structure from vasprun.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.complete_dos"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.complete_dos">[docs]</a>    <span class="k">def</span> <span class="nf">complete_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A complete dos object which incorporates the total dos and all projected dos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CompleteDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vasprun.get_band_structure"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.get_band_structure">[docs]</a>    <span class="k">def</span> <span class="nf">get_band_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kpoints_filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the band structure.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            kpoints_filename:</span>
<span class="sd">                Full path of the KPOINTS file from which the band structure is generated.</span>
<span class="sd">                If none is provided, the code will try to intelligently determine the appropriate</span>
<span class="sd">                KPOINTS file by substituting the filename of the vasprun.xml with KPOINTS.</span>
<span class="sd">                The latter is the default behavior.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            Band structure object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kpoints_filename</span><span class="p">:</span>
            <span class="n">kpoints_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;vasprun.xml&#39;</span><span class="p">,</span> <span class="s">&#39;KPOINTS&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">kpoints_filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">VaspParserError</span><span class="p">(</span><span class="s">&#39;KPOINTS file needed to obtain band structure.&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">kpoints_filename</span><span class="p">)</span>
        <span class="n">labels_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">kpts</span><span class="p">))</span>
        <span class="n">lattice_rec</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice_rec</span><span class="p">)</span>
        <span class="c">#make the labels_dict to work with cartesian</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">coord_type</span> <span class="o">==</span> <span class="s">&quot;Reciprocal&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">labels_dict</span><span class="p">:</span>
                <span class="n">labels_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice_rec</span><span class="o">.</span><span class="n">get_cartesian_coords</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]))</span>
        <span class="n">kpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">lattice_rec</span><span class="o">.</span><span class="n">get_cartesian_coords</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints</span><span class="p">]</span>
        <span class="n">eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>
        <span class="n">eigenvals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eig</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">)])):</span>
            <span class="n">eigenvals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;energy&#39;</span><span class="p">:[</span><span class="n">eig</span><span class="p">[(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">)][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpoints</span><span class="p">))],</span>
                              <span class="s">&#39;occup&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">eig</span><span class="p">[(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">)][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpoints</span><span class="p">))]})</span>
        <span class="k">return</span> <span class="n">Bandstructure</span><span class="p">(</span><span class="n">kpoints</span><span class="p">,</span> <span class="n">eigenvals</span><span class="p">,</span> <span class="n">labels_dict</span><span class="p">,</span> <span class="n">lattice_rec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.eigenvalue_band_properties"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.eigenvalue_band_properties">[docs]</a>    <span class="k">def</span> <span class="nf">eigenvalue_band_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns band properties from the eigenvalues.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (band gap, cbm, vbm, is_band_gap_direct)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vbm</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">)</span>
        <span class="n">vbm_kpoint</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">cbm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">)</span>
        <span class="n">cbm_kpoint</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">eigenval</span><span class="p">,</span> <span class="n">occu</span><span class="p">)</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">occu</span> <span class="o">&gt;</span> <span class="mf">1e-8</span> <span class="ow">and</span> <span class="n">eigenval</span> <span class="o">&gt;</span> <span class="n">vbm</span><span class="p">:</span>
                    <span class="n">vbm</span> <span class="o">=</span> <span class="n">eigenval</span>
                    <span class="n">vbm_kpoint</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">occu</span> <span class="o">&lt;=</span> <span class="mf">1e-8</span> <span class="ow">and</span> <span class="n">eigenval</span> <span class="o">&lt;</span> <span class="n">cbm</span><span class="p">:</span>
                    <span class="n">cbm</span> <span class="o">=</span> <span class="n">eigenval</span>
                    <span class="n">cbm_kpoint</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">cbm</span> <span class="o">-</span> <span class="n">vbm</span><span class="p">,</span> <span class="n">cbm</span><span class="p">,</span> <span class="n">vbm</span><span class="p">,</span> <span class="n">vbm_kpoint</span> <span class="o">==</span> <span class="n">cbm_kpoint</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vasprun.to_dict"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Vasprun.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        json-friendly dict representation for Vasprun for transferring between different applications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;vasp_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vasp_version</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;has_vasp_completed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">converged</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;nsites&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;unit_cell_formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">to_dict</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="o">.</span><span class="n">composition</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;reduced_cell_formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Composition</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">reduced_formula</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;pretty_formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">reduced_formula</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potcar_symbols</span><span class="p">]</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbols</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;nelements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;is_hubbard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDAU&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;is_hubbard&#39;</span><span class="p">]:</span>
            <span class="n">us</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDAUU&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDAUU&#39;</span><span class="p">))</span>
            <span class="n">js</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDAUJ&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LDAUJ&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">us</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;hubbards&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">us</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">js</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">))}</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">us</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">js</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;is_hubbard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;hubbards&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VaspParserError</span><span class="p">(</span><span class="s">&quot;Length of U value parameters and atomic symbols are mismatched&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;hubbards&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;is_hubbard&#39;</span><span class="p">]:</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;run_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;GGA+U&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LHFCALC&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;run_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;HF&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;run_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;GGA&quot;</span>

        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;incar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;crystal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_structure</span><span class="o">.</span><span class="n">to_dict</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;kpoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">to_dict</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;kpoints&#39;</span><span class="p">][</span><span class="s">&#39;actual_points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;abc&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints_weights</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints</span><span class="p">))]</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;potcar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potcar_symbols</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;lattice_rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_rec</span><span class="o">.</span><span class="n">to_dict</span>

        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;ionic_steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;final_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_energy</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;final_energy_per_atom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_energy</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;crystal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_structure</span><span class="o">.</span><span class="n">to_dict</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;efermi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>
        <span class="c">#{(kpoint index, Spin.up):array(float)}</span>

        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;eigenvalues&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">spin</span><span class="p">),</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;eigenvalues&#39;</span><span class="p">]:</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;eigenvalues&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span><span class="n">values</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;eigenvalues&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)][</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">)]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="p">(</span><span class="n">gap</span><span class="p">,</span> <span class="n">cbm</span><span class="p">,</span> <span class="n">vbm</span><span class="p">,</span> <span class="n">is_direct</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalue_band_properties</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">bandgap</span> <span class="o">=</span> <span class="n">gap</span><span class="p">,</span> <span class="n">cbm</span> <span class="o">=</span> <span class="n">cbm</span><span class="p">,</span> <span class="n">vbm</span> <span class="o">=</span> <span class="n">vbm</span><span class="p">,</span> <span class="n">is_gap_direct</span> <span class="o">=</span> <span class="n">is_direct</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">d</span>

</div></div>
<div class="viewcode-block" id="VasprunHandler"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VasprunHandler">[docs]</a><span class="k">class</span> <span class="nc">VasprunHandler</span><span class="p">(</span><span class="n">xml</span><span class="o">.</span><span class="n">sax</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">ContentHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sax handler for vasprun.xml.</span>
<span class="sd">    Attributes are mirrored into Vasprun object.</span>
<span class="sd">    </span>
<span class="sd">    Author: Shyue Ping Ong</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="c"># variables to be filled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vasp_version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar_symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="p">{}</span><span class="c">#  will  be  {(kpoint index, Spin.up):array(float)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># should be a list of dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_rec</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_read</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_calculations_read</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_structure</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_rec_lattice</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_calculation</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_eigen</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_dos</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_efermi</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_atoms</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_lattice</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_positions</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dos_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idos_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dos_has_errors</span> <span class="o">=</span> <span class="bp">False</span> <span class="c">#will be set to true if there is an error parsing the Dos.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>


<div class="viewcode-block" id="VasprunHandler.in_all"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VasprunHandler.in_all">[docs]</a>    <span class="k">def</span> <span class="nf">in_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_tags</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;in_&#39;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">xml_tags</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="VasprunHandler.startElement"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VasprunHandler.startElement">[docs]</a>    <span class="k">def</span> <span class="nf">startElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">else</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c">#Nested if loops makes reading much faster.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_read</span><span class="p">:</span> <span class="c">#reading input parameters</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;incar&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_type</span> <span class="o">=</span> <span class="s">&#39;float&#39;</span> <span class="k">if</span> <span class="s">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">else</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;kpoints&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;generation&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;kpoints&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;Kpoints from vasprun.xml&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">num_kpts</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&#39;param&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">kpts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">kpts_shift</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;c&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;atoms&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;atomtypes&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;version&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;generator&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span> <span class="c">#reading calculations and structures.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_calculation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;scstep&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;forces&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;stress&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_positions</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_structure</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;basis&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_lattice</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;positions&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_positions</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;v&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rec_basis&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_rec_lattice</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;calculation&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scdata</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_calculation</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;scstep&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scstep</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;structure&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latticestr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latticerec</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">posstr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_structure</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;varray&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;forces&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;stress&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">posstr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;eigenvalues&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_calculations_read</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_eigen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;r&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="ow">and</span> <span class="s">&quot;comment&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="n">comment</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;comment&quot;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>
                    <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spin&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">eigen_spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;spin 1&quot;</span> <span class="k">else</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>
                    <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;kpoint&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">eigen_kpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">comment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_dos</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;i&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;efermi&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;r&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="ow">and</span> <span class="s">&quot;comment&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="n">comment</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;comment&quot;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;partial&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;ion&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pdos_ion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">comment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">comment</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spin&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pdos_spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;spin 1&quot;</span> <span class="k">else</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;dos&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idos</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_dos</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;eigenvalues&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="p">{}</span><span class="c">#  will  be  {(kpoint index, Spin.up):array(float)}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_eigen</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="VasprunHandler.characters"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VasprunHandler.characters">[docs]</a>    <span class="k">def</span> <span class="nf">characters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_val</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_lattice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latticestr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_positions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">posstr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_rec_lattice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latticerec</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


    <span class="c">#To correct for stupid vasp bug which names Xenon as X!!</span></div>
    <span class="n">EL_MAPPINGS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;X&#39;</span><span class="p">:</span><span class="s">&#39;Xe&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="VasprunHandler.endElement"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VasprunHandler.endElement">[docs]</a>    <span class="k">def</span> <span class="nf">endElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_read</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;incar&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;generator&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;i&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;version&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vasp_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;atoms&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">sym</span> <span class="k">if</span> <span class="n">sym</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VasprunHandler</span><span class="o">.</span><span class="n">EL_MAPPINGS</span> <span class="k">else</span> <span class="n">VasprunHandler</span><span class="o">.</span><span class="n">EL_MAPPINGS</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;atomtypes&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">potcar_symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">potcar_symbols</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">5</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input_read</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;c&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;atoms&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;atomtypes&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">potcar_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;incar&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_v_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_v_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar_param</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;kpoints&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;kpointlist&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;weights&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">actual_kpoints_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;divisions&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">kpts</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())]]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;usershift&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">kpts_shift</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;genvec1&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;genvec2&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;genvec3&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;shift&quot;</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_calculation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;scstep&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scstep</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;scstep&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scstep</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;varray&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;forces&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">forces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">posstr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;varray&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&#39;varray&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;stress&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">posstr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stress</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;calculation&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;electronic_steps&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">scdata</span><span class="p">,</span> <span class="s">&#39;structure&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;forces&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span> <span class="s">&#39;stress&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">stress</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_calculation</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_structure</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_positions</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_lattice</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_lattice_rec</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_rec_lattice</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;structure&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latticestr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">posstr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lattice_rec</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latticerec</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_structure</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_dos</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;i&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;i&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;efermi&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;r&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;total&quot;</span><span class="p">]</span>  <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spin&quot;</span><span class="p">):</span>
                        <span class="n">tok</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dos_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">idos_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;r&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;partial&quot;</span><span class="p">]</span>  <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spin&quot;</span><span class="p">):</span>
                        <span class="n">tok</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;total&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spin&quot;</span><span class="p">):</span>
                        <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;spin 1&quot;</span> <span class="k">else</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">idos</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies_val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies_val</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dos_val</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">idos_val</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;partial&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spin&quot;</span><span class="p">):</span>
                        <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;spin 1&quot;</span> <span class="k">else</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">norbitals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norbitals</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdos_ion</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">spin</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;partial&quot;</span><span class="p">:</span>
                        <span class="n">all_pdos</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">natom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomic_symbols</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">natom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">all_pdos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">())</span>
                            <span class="k">for</span> <span class="n">iorbital</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norbitals</span><span class="p">):</span>
                                <span class="n">updos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[(</span><span class="n">iatom</span><span class="p">,</span> <span class="n">iorbital</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">)]</span>
                                <span class="n">downdos</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">iatom</span><span class="p">,</span> <span class="n">iorbital</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[(</span><span class="n">iatom</span><span class="p">,</span> <span class="n">iorbital</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">)]</span>
                                <span class="k">if</span> <span class="n">downdos</span><span class="p">:</span>
                                    <span class="n">all_pdos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span><span class="p">,</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span><span class="n">updos</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span><span class="n">downdos</span><span class="p">},</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">from_vasp_index</span><span class="p">(</span><span class="n">iorbital</span><span class="p">)))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">all_pdos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span><span class="p">,</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span><span class="n">updos</span><span class="p">},</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">from_vasp_index</span><span class="p">(</span><span class="n">iorbital</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span> <span class="o">=</span> <span class="n">all_pdos</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;total&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">idos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dos_energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idos</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;dos&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read_dos</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dos_has_errors</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_eigen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;r&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;kpoint&quot;</span><span class="p">):</span>
                    <span class="n">tok</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tok</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;set&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;set&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;kpoint&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigen_kpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_spin</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;eigenvalues&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_eigen</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</div></div>
<div class="viewcode-block" id="parse_parameters"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.parse_parameters">[docs]</a><span class="k">def</span> <span class="nf">parse_parameters</span><span class="p">(</span><span class="n">val_type</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert a Vasprun parameter into the proper type.</span>
<span class="sd">    Boolean, int and float types are converted.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        val_type : Value type parsed from vasprun.xml.</span>
<span class="sd">        val : Actual string value parsed for vasprun.xml.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">val_type</span> <span class="o">==</span> <span class="s">&quot;logical&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s">&quot;T&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">val_type</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">val_type</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_parse_v_parameters</span><span class="p">(</span><span class="n">val_type</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">param_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert a Vasprun array-type parameter into the proper type.</span>
<span class="sd">    Boolean, int and float types are converted.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        val_type: </span>
<span class="sd">            Value type parsed from vasprun.xml.</span>
<span class="sd">        val: </span>
<span class="sd">            Actual string value parsed for vasprun.xml.</span>
<span class="sd">        filename: </span>
<span class="sd">            Fullpath of vasprun.xml. Used for robust error handling.  E.g.,</span>
<span class="sd">            if vasprun.xml contains *** for some Incar parameters, the code will try</span>
<span class="sd">            to read from an INCAR file present in the same directory.</span>
<span class="sd">        param_name: </span>
<span class="sd">            Name of parameter.</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        Parsed value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">val_type</span> <span class="o">==</span> <span class="s">&quot;logical&quot;</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&quot;T&quot;</span> <span class="k">else</span> <span class="bp">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">val_type</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c"># Fix for stupid error in vasprun sometimes which displays</span>
            <span class="c"># LDAUL/J as 2****</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_parse_from_incar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Error in parsing vasprun.xml&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">val_type</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c"># Fix for stupid error in vasprun sometimes which displays</span>
            <span class="c"># MAGMOM as 2****</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_parse_from_incar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Error in parsing vasprun.xml&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="k">def</span> <span class="nf">_parse_from_incar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to parse a parameter from the INCAR.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;INCAR&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;INCAR found. Using &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot; from INCAR.&quot;</span><span class="p">)</span>
            <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">incar</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">incar</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="bp">None</span>


<div class="viewcode-block" id="Outcar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Outcar">[docs]</a><span class="k">class</span> <span class="nc">Outcar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parser for data in OUTCAR that is not available in Vasprun.xml</span>

<span class="sd">    Note, this class works a bit differently than most of the other VaspObjects, since the OUTCAR can</span>
<span class="sd">    be very different depending on which &quot;type of run&quot; performed.</span>

<span class="sd">    Creating the OUTCAR class with a filename reads &quot;regular parameters&quot; that are always present.</span>
<span class="sd">    </span>
<span class="sd">    Default attributes:</span>
<span class="sd">        magnetization:</span>
<span class="sd">            Magnetization on each ion as a tuple of dict, e.g., ({&#39;d&#39;: 0.0, &#39;p&#39;: 0.003, &#39;s&#39;: 0.002, &#39;tot&#39;: 0.005}, ... )</span>
<span class="sd">            Note that this data is not always present.  LORBIT must be set to some other value than the default.</span>
<span class="sd">        charge:</span>
<span class="sd">            Charge on each ion as a tuple of dict, e.g., ({&#39;p&#39;: 0.154, &#39;s&#39;: 0.078, &#39;d&#39;: 0.0, &#39;tot&#39;: 0.232}, ...)</span>
<span class="sd">            Note that this data is not always present.  LORBIT must be set to some other value than the default.</span>
<span class="sd">        is_stopped:</span>
<span class="sd">            True if OUTCAR is from a stopped run (using STOPCAR, see Vasp Manual).</span>
<span class="sd">        run_stats:</span>
<span class="sd">            Various useful run stats as a dict including &#39;System time (sec)&#39;, &#39;Total CPU time used (sec)&#39;</span>
<span class="sd">            &#39;Elapsed time (sec)&#39;, &#39;Maximum memory used (kb)&#39;, &#39;Average memory used (kb)&#39;, &#39;User time (sec)&#39;.</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">    One can then call a specific reader depending on the type of run being perfromed. These are currently:</span>
<span class="sd">       read_igpar()</span>
<span class="sd">       read_lepsilon()</span>
<span class="sd">       read_lcalcpol()</span>

<span class="sd">    See the documentation of those methods for more documentation.</span>
<span class="sd">    </span>
<span class="sd">    Authors: Rickard Armiento, Shyue Ping Ong</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="n">read_charge</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">read_mag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">run_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">clean</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">clean</span> <span class="o">==</span> <span class="s">&quot;total charge&quot;</span><span class="p">:</span>
                <span class="n">read_charge</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">charge</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">clean</span> <span class="o">==</span> <span class="s">&quot;magnetization (x)&quot;</span><span class="p">:</span>
                <span class="n">read_mag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">read_charge</span> <span class="ow">or</span> <span class="n">read_mag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">clean</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;# of ion&quot;</span><span class="p">):</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s{2,}&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">clean</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;tot&quot;</span><span class="p">):</span>
                    <span class="n">read_charge</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">read_mag</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\s*(\d+)\s+(([\d\.\-]+)\s+)+&quot;</span><span class="p">,</span> <span class="n">clean</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">to_append</span> <span class="o">=</span> <span class="n">charge</span> <span class="k">if</span> <span class="n">read_charge</span> <span class="k">else</span> <span class="n">mag</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;[\d\.\-]+&quot;</span><span class="p">,</span> <span class="n">clean</span><span class="p">)</span>
                        <span class="n">to_append</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))})</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;soft stop encountered!  aborting job&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;\((sec|kb)\):&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">tok</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
                <span class="n">run_stats</span><span class="p">[</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_stats</span> <span class="o">=</span> <span class="n">run_stats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnetization</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>

<div class="viewcode-block" id="Outcar.read_igpar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Outcar.read_igpar">[docs]</a>    <span class="k">def</span> <span class="nf">read_igpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Renders accessible:</span>
<span class="sd">            er_ev = e&lt;r&gt;_ev (dictionary with Spin.up/Spin.down as keys)</span>
<span class="sd">            er_bp = e&lt;r&gt;_bp (dictionary with Spin.up/Spin.down as keys)</span>
<span class="sd">            er_ev_tot = spin up + spin down summed</span>
<span class="sd">            er_bp_tot = spin up + spin down summed</span>
<span class="sd">            p_elc = spin up + spin down summed</span>
<span class="sd">            p_ion = spin up + spin down summed</span>
<span class="sd">        </span>
<span class="sd">        (See VASP section &#39;LBERRY,  IGPAR,  NPPSTR,  DIPOL tags&#39; for info on what these are)&quot;&quot;&quot;</span>

        <span class="c"># variables to be filled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">er_ev</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c">#  will  be  dict (Spin.up/down) of array(3*float)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">er_bp</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c">#  will  be  dics (Spin.up/down) of array(3*float)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">er_ev_tot</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># will be array(3*float)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">er_bp_tot</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># will be array(3*float)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_elec</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_ion</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># Nonspin cases</span>
            <span class="k">def</span> <span class="nf">er_ev</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">results</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">];</span> <span class="n">results</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *e&lt;r&gt;_ev=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">er_ev</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">er_bp</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span> <span class="n">results</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *e&lt;r&gt;_bp=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">er_bp</span><span class="p">])</span>

            <span class="c"># Spin cases</span>
            <span class="k">def</span> <span class="nf">er_ev_up</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))]);</span> <span class="n">results</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^.*Spin component 1 *e&lt;r&gt;_ev=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">er_ev_up</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">er_bp_up</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *e&lt;r&gt;_bp=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">er_bp_up</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">er_ev_dn</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))]);</span> <span class="n">results</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^.*Spin component 2 *e&lt;r&gt;_ev=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">er_ev_dn</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">er_bp_dn</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *e&lt;r&gt;_bp=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">,</span> <span class="n">er_bp_dn</span><span class="p">])</span>

            <span class="c"># Always present spin/non-spin</span>
            <span class="k">def</span> <span class="nf">p_elc</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">p_elc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^.*Total electronic dipole moment: *p\[elc\]=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p_elc</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">p_ion</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">p_ion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^.*ionic dipole moment: *p\[ion\]=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p_ion</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">er_ev</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">er_bp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

            <span class="n">micro_pyawk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">er_ev_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_ev</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">er_bp_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_bp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">er_ev_tot</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">er_bp_tot</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;IGPAR OUTCAR could not be parsed.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Outcar.read_lepsilon"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Outcar.read_lepsilon">[docs]</a>    <span class="k">def</span> <span class="nf">read_lepsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># variables to be filled</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">dielectric_section_start</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;MACROSCOPIC STATIC DIELECTRIC TENSOR&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dielectric_section_start</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">dielectric_section_start2</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dielectric_section_start2</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">dielectric_data</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_tensor</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))]);</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *([-0-9.Ee+]+) +([-0-9.Ee+]+) +([-0-9.Ee+]+) *$&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dielectric_data</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">dielectric_section_stop</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dielectric_section_stop</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dielectric_index</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dielectric_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>


            <span class="k">def</span> <span class="nf">piezo_section_start</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">piezo_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;PIEZOELECTRIC TENSOR  for field in x, y, z        \(e  Angst\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">piezo_section_start</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">piezo_data</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">piezo_tensor</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">piezo_index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">))]);</span> <span class="n">results</span><span class="o">.</span><span class="n">piezo_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *[xyz] +([-0-9.Ee+]+) +([-0-9.Ee+]+) +([-0-9.Ee+]+) *([-0-9.Ee+]+) +([-0-9.Ee+]+) +([-0-9.Ee+]+)*$&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">piezo_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">piezo_data</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">piezo_section_stop</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">piezo_index</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">piezo_index</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">piezo_section_stop</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">piezo_index</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">piezo_tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>


            <span class="k">def</span> <span class="nf">born_section_start</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">born_ion</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;BORN EFFECTIVE CHARGES \(in e, cummulative output\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">born_section_start</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">born_ion</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">born_ion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">results</span><span class="o">.</span><span class="n">born</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">born_ion</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;ion +([0-9]+)&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">born_ion</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">born_ion</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">born_data</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">born</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">born_ion</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]);</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^ *([1-3]+) +([-0-9.Ee+]+) +([-0-9.Ee+]+) +([-0-9.Ee+]+)$&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">born_ion</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">born_data</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">born_section_stop</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">born_index</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">results</span><span class="o">.</span><span class="n">born_ion</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">born_section_stop</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">born_ion</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">born</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c">#def debug_print(results,match): print &quot;MATCH:&quot;,match.group(0),&#39;:&#39;,results.born_ion</span>
            <span class="c">#micro_pyawk(filename,search,self,debug=debug_print, postdebug=debug_print)</span>

            <span class="n">micro_pyawk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;LEPSILON OUTCAR could not be parsed.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Outcar.read_lcalcpol"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Outcar.read_lcalcpol">[docs]</a>    <span class="k">def</span> <span class="nf">read_lcalcpol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># variables to be filled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_elec</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_ion</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c"># Always present spin/non-spin</span>
            <span class="k">def</span> <span class="nf">p_elc</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">p_elc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^.*Total electronic dipole moment: *p\[elc\]=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p_elc</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">p_ion</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">match</span><span class="p">):</span> <span class="n">results</span><span class="o">.</span><span class="n">p_ion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
            <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;^.*Ionic dipole moment: *p\[ion\]=\( *([-0-9.Ee+]*) *([-0-9.Ee+]*) *([-0-9.Ee+]*) *\)&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p_ion</span><span class="p">])</span>

            <span class="n">micro_pyawk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;CLACLCPOL OUTCAR could not be parsed.&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="VolumetricData"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VolumetricData">[docs]</a><span class="k">class</span> <span class="nc">VolumetricData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple volumetric object for reading LOCPOT and CHGCAR type files.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        name : The name from the comment line.</span>
<span class="sd">        poscar : Poscar object</span>
<span class="sd">        spinpolarized : True if run is spin polarized</span>
<span class="sd">        dim: Tuple of dimensions of volumetric grid in each direction (nx, ny, nz)</span>
<span class="sd">        data : Actual data as a dict of {grid coordinate: value}.  Grid coordinate is a (x,y,z) tuple.</span>
<span class="sd">        ngridpts: Total number of grid points in volumetric data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinpolarized</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ngridpts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_add</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_add</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>

<div class="viewcode-block" id="VolumetricData.linear_add"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VolumetricData.linear_add">[docs]</a>    <span class="k">def</span> <span class="nf">linear_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">scalefactor</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Method to do a linear sum of volumetric objects.  Use by + and - operators as well.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#To add checks</span>
        <span class="n">summed</span> <span class="o">=</span> <span class="n">VolumetricData</span><span class="p">()</span>
        <span class="n">summed</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">summed</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span>
        <span class="n">summed</span><span class="o">.</span><span class="n">spinpolarized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinpolarized</span>
        <span class="n">summed</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="n">summed</span><span class="o">.</span><span class="n">numpts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ngridpts</span>
        <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">summed</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">+</span> <span class="n">scalefactor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">summed</span>
</div>
    <span class="k">def</span> <span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="n">reader</span> <span class="o">=</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c"># Skip whitespace between POSCAR and LOCPOT data</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">dimensionline</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">spinpolarized</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># Search for the second dimension line, where the next spin starts</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dimensionline</span> <span class="o">==</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                <span class="n">spinpolarized</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">spinpolarized</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spinpolarized</span> <span class="o">=</span> <span class="n">spinpolarized</span>

        <span class="c"># Read three numbers that is the dimension</span>
        <span class="n">dimensionexpr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;([0-9]+) +([0-9]+) +([0-9]+)&#39;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">dimensionexpr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dimensionline</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ngridpts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">uppot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">uppot</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">count</span><span class="p">])</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">spinpolarized</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
            <span class="n">downpot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="n">downpot</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">count</span><span class="p">])</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span><span class="n">uppot</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span><span class="n">downpot</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span><span class="n">uppot</span><span class="p">}</span>

</div>
<div class="viewcode-block" id="Locpot"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Locpot">[docs]</a><span class="k">class</span> <span class="nc">Locpot</span><span class="p">(</span><span class="n">VolumetricData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple object for reading a LOCPOT file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Locpot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="Locpot.get_avg_potential_along_axis"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Locpot.get_avg_potential_along_axis">[docs]</a>    <span class="k">def</span> <span class="nf">get_avg_potential_along_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the averaged LOCPOT along a certain axis direction. Useful for visualizing Hartree Potentials.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ind : Index of axis.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Average Hatree potential along axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>

        <span class="n">ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ng</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ng</span><span class="p">[</span><span class="n">ind</span><span class="p">]):</span>
            <span class="n">mysum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ng</span><span class="p">[(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ng</span><span class="p">[(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">mysum</span> <span class="o">+=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">mysum</span> <span class="o">+=</span> <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">mysum</span> <span class="o">+=</span> <span class="n">m</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

            <span class="n">avg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mysum</span> <span class="o">/</span> <span class="p">(</span><span class="n">ng</span><span class="p">[(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ng</span><span class="p">[(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">avg</span>
</div></div>
<div class="viewcode-block" id="Chgcar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Chgcar">[docs]</a><span class="k">class</span> <span class="nc">Chgcar</span><span class="p">(</span><span class="n">VolumetricData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple object for reading a CHGCAR file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Chgcar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c">#Chgcar format is total density in first set, and moment density in second set.</span>
        <span class="c"># need to split them into up and down.</span>
        <span class="n">updowndata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">updowndata</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span>
        <span class="n">updowndata</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">updowndata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distance_matrix</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_calculate_distance_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">struct</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">z</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">distances</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">=</span> <span class="n">structure</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">distance_and_image_from_frac_coords</span><span class="p">(</span><span class="n">pt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distance_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">distances</span>

<div class="viewcode-block" id="Chgcar.get_diff_int_charge"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Chgcar.get_diff_int_charge">[docs]</a>    <span class="k">def</span> <span class="nf">get_diff_int_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get differential integrated charge of atom index ind up to radius.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ind : Index of atom.</span>
<span class="sd">            radius : Radius of integration.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Differential integrated charge.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_matrix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_distance_matrix</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="n">intchg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">][(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">:</span>
                <span class="n">intchg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">][</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">intchg</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ngridpts</span>
</div>
<div class="viewcode-block" id="Chgcar.get_diff_int_charge_slow"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Chgcar.get_diff_int_charge_slow">[docs]</a>    <span class="k">def</span> <span class="nf">get_diff_int_charge_slow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated.  **Much** slower algorithm for finding differential integrated charge.  Used mainly for testing purposes.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ind : Index of atom.</span>
<span class="sd">            radius : Radius of integration.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Differential integrated charge.       </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">struct</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="n">intchg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ioncoord</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">frac_coords</span>
        <span class="n">iongridpt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ioncoord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">max_grid_pts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">radius</span> <span class="o">/</span> <span class="n">st</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">iongridpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">max_grid_pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iongridpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">max_grid_pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">iongridpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">max_grid_pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iongridpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">max_grid_pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">iongridpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">max_grid_pts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">iongridpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">max_grid_pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">modx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mody</span> <span class="o">=</span> <span class="n">y</span> <span class="o">%</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">modz</span> <span class="o">=</span> <span class="n">z</span> <span class="o">%</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">modx</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">mody</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">modz</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">distance_and_image_from_frac_coords</span><span class="p">(</span><span class="n">pt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">:</span>
                        <span class="n">intchg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">modx</span><span class="p">,</span> <span class="n">mody</span><span class="p">,</span> <span class="n">modz</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">][</span><span class="n">modx</span><span class="p">,</span> <span class="n">mody</span><span class="p">,</span> <span class="n">modz</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">intchg</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ngridpts</span>
</div></div>
<div class="viewcode-block" id="Procar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Procar">[docs]</a><span class="k">class</span> <span class="nc">Procar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object for reading a PROCAR file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="c">#create and return data object containing the information of a PROCAR type file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="Procar.get_d_occupation"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Procar.get_d_occupation">[docs]</a>    <span class="k">def</span> <span class="nf">get_d_occupation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomNo</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">atomNo</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
</div>
    <span class="k">def</span> <span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">clean_lines</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kpointexpr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;^\s*k-point\s+(\d+).*weight = ([0-9\.]+)&quot;</span><span class="p">)</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^\s*([0-9]+)\s+&#39;</span><span class="p">)</span>
        <span class="n">dataexpr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;[\.0-9]+&#39;</span><span class="p">)</span>
        <span class="n">currentKpoint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kpointexpr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">kpointexpr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">currentKpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">currentKpoint</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="n">linedata</span> <span class="o">=</span> <span class="n">dataexpr</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">linefloatdata</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">linedata</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linefloatdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">linefloatdata</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">linefloatdata</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span>
</div>
<div class="viewcode-block" id="Oszicar"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Oszicar">[docs]</a><span class="k">class</span> <span class="nc">Oszicar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A basic parser for an OSZICAR output from VASP.  In general, while the OSZICAR is useful for a quick look</span>
<span class="sd">    at the output from a VASP run, we recommend that you use the Vasprun parser instead, which gives far richer information</span>
<span class="sd">    about a run.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        electronic_steps:</span>
<span class="sd">            All electronic steps as a list of list of dict. e.g., </span>
<span class="sd">            [[{&#39;rms&#39;: 160.0, &#39;E&#39;: 4507.24605593, &#39;dE&#39;: 4507.2, &#39;N&#39;: 1, &#39;deps&#39;: -17777.0, &#39;ncg&#39;: 16576}, ...], [....]</span>
<span class="sd">            where electronic_steps[index] refers the list of electronic steps in one ionic_step, electronic_steps[index][subindex]</span>
<span class="sd">            refers to a particular electronic step at subindex in ionic step at index.  The dict of properties depends on the type</span>
<span class="sd">            of VASP run, but in general, &quot;E&quot;, &quot;dE&quot; and &quot;rms&quot; should be present in almost all runs.</span>
<span class="sd">        ionic_steps:</span>
<span class="sd">            All ionic_steps as a list of dict, e.g.,</span>
<span class="sd">            [{&#39;dE&#39;: -526.36, &#39;E0&#39;: -526.36024, &#39;mag&#39;: 0.0, &#39;F&#39;: -526.36024}, ...]</span>
<span class="sd">            This is the typical output from VASP at the end of each ionic step.</span>

<span class="sd">    Please refer to the vasp manual for the definition for each of the terms.</span>
<span class="sd">            </span>
<span class="sd">    In addition, two convenience properties, all_energies and final_energy are provided for quick access to the commonly used </span>
<span class="sd">    energetic output from a run.  Please refer to the doc for those two methods for details.    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">electronic_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ionic_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ionic_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;(\d+)\s+F=\s*([\d\-\.E\+]+)\s+E0=\s*([\d\-\.E\+]+)\s+d\s*E\s*=\s*([\d\-\.E\+]+)\s+mag=\s*([\d\-\.E\+]+)&quot;</span><span class="p">)</span>
        <span class="n">electronic_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;\s*\w+\s*:(.*)&quot;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">smart_convert</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s">&quot;N&quot;</span> <span class="ow">or</span> <span class="n">header</span> <span class="o">==</span> <span class="s">&quot;ncg&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">electronic_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">toks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">smart_convert</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">toks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">))}</span>
                    <span class="k">if</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
                        <span class="n">electronic_steps</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">electronic_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ionic_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">ionic_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">ionic_steps</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;F&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="s">&#39;E0&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="s">&#39;dE&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="s">&#39;mag&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">))})</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^\s*N\s+E\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;d eps&quot;</span><span class="p">,</span> <span class="s">&quot;deps&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronic_steps</span> <span class="o">=</span> <span class="n">electronic_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span> <span class="o">=</span> <span class="n">ionic_steps</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Oszicar.all_energies"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Oszicar.all_energies">[docs]</a>    <span class="k">def</span> <span class="nf">all_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compilation of all energies from all electronic steps and ionic steps as a list of list of energies, e.g.,</span>
<span class="sd">        [[4507.24605593, 143.824705755, -512.073149912, -547.713139455, ...], ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_energies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electronic_steps</span><span class="p">)):</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="n">step</span><span class="p">[</span><span class="s">&#39;E&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_steps</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;F&#39;</span><span class="p">])</span>
            <span class="n">all_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_energies</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Oszicar.final_energy"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.Oszicar.final_energy">[docs]</a>    <span class="k">def</span> <span class="nf">final_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Final energy from run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionic_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;F&#39;</span><span class="p">]</span>
</div></div>
<div class="viewcode-block" id="VaspParserError"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.VaspParserError">[docs]</a><span class="k">class</span> <span class="nc">VaspParserError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception class for Structure.</span>
<span class="sd">    Raised when the structure has problems, e.g., atoms that are too close.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;VaspParserError : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>
</div>
<div class="viewcode-block" id="get_band_structure_from_vasp"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.get_band_structure_from_vasp">[docs]</a><span class="k">def</span> <span class="nf">get_band_structure_from_vasp</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    method taking a directory with a band structure vasp run</span>
<span class="sd">    and returning the corresponding Bandstructure Object</span>
<span class="sd">    also takes into account runs that have been separated in several branches</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&quot;/branch_0&quot;</span><span class="p">)):</span>
        <span class="c">#get all branches in a list of BandStructurs</span>
        <span class="n">list_branches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">listdir_clean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&quot;branch&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">listdir_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listdir_clean</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir_clean</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">i</span><span class="p">):</span>
                    <span class="n">list_branches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_band_structure_from_vasp_individual</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">get_reconstructed_band_structure</span><span class="p">(</span><span class="n">list_branches</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_band_structure_from_vasp_individual</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_band_structure_from_vasp_individual"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.get_band_structure_from_vasp_individual">[docs]</a><span class="k">def</span> <span class="nf">get_band_structure_from_vasp_individual</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">run</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&quot;/vasprun.xml&quot;</span><span class="p">)</span>
    <span class="n">labels_dict</span> <span class="o">=</span> <span class="n">parse_kpoint_labels</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&quot;/KPOINTS&quot;</span><span class="p">)</span>
    <span class="n">lattice_rec</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">final_structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">reciprocal_lattice</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">labels_dict</span><span class="p">:</span>
        <span class="n">labels_dict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice_rec</span><span class="o">.</span><span class="n">get_cartesian_coords</span><span class="p">(</span><span class="n">labels_dict</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
    <span class="n">kpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">lattice_rec</span><span class="o">.</span><span class="n">get_cartesian_coords</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">actual_kpoints</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">actual_kpoints</span><span class="p">))]</span>
    <span class="n">dict_eigen</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">to_dict</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">][</span><span class="s">&#39;eigenvalues&#39;</span><span class="p">]</span>
    <span class="n">eigenvals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_band</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_eigen</span><span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">][</span><span class="s">&#39;up&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_band</span><span class="p">):</span>
        <span class="n">eigenvals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;energy&#39;</span><span class="p">:[</span><span class="n">dict_eigen</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="s">&#39;up&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpoints</span><span class="p">))]})</span>
        <span class="n">eigenvals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;occup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dict_eigen</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="s">&#39;up&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpoints</span><span class="p">))]</span>
    <span class="n">bands</span> <span class="o">=</span> <span class="n">Bandstructure</span><span class="p">(</span><span class="n">kpoints</span><span class="p">,</span> <span class="n">eigenvals</span><span class="p">,</span> <span class="n">labels_dict</span><span class="p">,</span> <span class="n">run</span><span class="o">.</span><span class="n">final_structure</span><span class="p">,</span> <span class="n">run</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bands</span>
</div>
<div class="viewcode-block" id="parse_kpoint_labels"><a class="viewcode-back" href="../../../pymatgen.io.html#pymatgen.io.vaspio.parse_kpoint_labels">[docs]</a><span class="k">def</span> <span class="nf">parse_kpoint_labels</span><span class="p">(</span><span class="n">file_kpoints</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper method to parse a kpoint file and get the kpoint labels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">file_open_zip_aware</span><span class="p">(</span><span class="n">file_kpoints</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">dict_label_kpoints</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span><span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; +&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>
        <span class="n">dict_label_kpoints</span><span class="p">[</span><span class="n">tokens</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="n">array</span>

    <span class="k">return</span> <span class="n">dict_label_kpoints</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">pymatgen 1.7.2 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Shyue Ping Ong, Anubhav Jain, Michael Kocher, Geoffroy Hautier, Dan Gunter, William Davidson Richards.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>